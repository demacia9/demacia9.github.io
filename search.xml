<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>监控工具-Prometheus</title>
      <link href="/2023/09/26/%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7-Prometheus/"/>
      <url>/2023/09/26/%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7-Prometheus/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>监控工具-Zabbix</title>
      <link href="/2023/05/28/%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7-Zabbix/"/>
      <url>/2023/05/28/%E7%9B%91%E6%8E%A7%E5%B7%A5%E5%85%B7-Zabbix/</url>
      
        <content type="html"><![CDATA[<h1 id="Zabbix安装部署"><a href="#Zabbix安装部署" class="headerlink" title="Zabbix安装部署"></a>Zabbix安装部署</h1><h2 id="一、部署zabbix监控平台"><a href="#一、部署zabbix监控平台" class="headerlink" title="一、部署zabbix监控平台"></a>一、部署zabbix监控平台</h2><p>a. 安装zabbix下载源</p><pre><code>[root@zutuanxue ~]# rpm -Uvh https://repo.zabbix.com/zabbix/4.4/rhel/8/x86_64/zabbix-release-4.4-1.el8.noarch.rpm[root@zutuanxue ~]# dnf clean all</code></pre><p>b. 安装Zabbix server，Web前端，agent</p><pre><code>[root@zutuanxue ~]# dnf -y install zabbix-server-mysql zabbix-web-mysql zabbix-apache-conf zabbix-agent##注意：如果国外的官方源下载失败或者速度慢，直接切换阿里的源即可[root@zutuanxue ~]# cat /etc/yum.repos.d/zabbix.repo [zabbix]name=Zabbix Official Repository - $basearchbaseurl=https://mirrors.aliyun.com/zabbix/zabbix/4.4/rhel/8/$basearch/enabled=1gpgcheck=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591[zabbix-non-supported]name=Zabbix Official Repository non-supported - $basearch baseurl=http://repo.zabbix.com/non-supported/rhel/8/$basearch/enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIXgpgcheck=1##</code></pre><p>c. 创建初始数据库</p><pre><code>[root@zutuanxue ~]# systemctl restart mariadb.service [root@zutuanxue ~]# mysqladmin -u root password &#39;123456&#39;[root@zutuanxue ~]# mysql -u root -pEnter password: Welcome to the MariaDB monitor.  Commands end with ; or \g.Your MariaDB connection id is 9Server version: 10.3.11-MariaDB MariaDB ServerCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.MariaDB [(none)]&gt; create database zabbix character set utf8 collate utf8_bin;Query OK, 1 row affected (0.001 sec)MariaDB [(none)]&gt; grant all privileges on zabbix.* to zabbix@localhost identified by &#39;123456&#39;;Query OK, 0 rows affected (0.000 sec)MariaDB [(none)]&gt; quitBye导入初始架构和数据[root@zutuanxue ~]# zcat /usr/share/doc/zabbix-server-mysql/create.sql.gz | mysql -uzabbix -p zabbixEnter password: </code></pre><p>d. 为Zabbix server配置数据库<br>编辑配置文件 &#x2F;etc&#x2F;zabbix&#x2F;zabbix_server.conf</p><pre><code>[root@zutuanxue ~]# vim /etc/zabbix/zabbix_server.conf DBPassword=123456</code></pre><p>e. 为Zabbix前端配置PHP<br>编辑配置文件 &#x2F;etc&#x2F;php-fpm.d&#x2F;zabbix.conf</p><pre><code>[root@zutuanxue ~]# vim /etc/php-fpm.d/zabbix.conf php_value[date.timezone] = Asia/Shanghai</code></pre><p>f. 启动Zabbix server和agent进程<br>启动Zabbix server和agent进程，并为它们设置开机自启：</p><pre><code>[root@zutuanxue ~]# systemctl restart zabbix-server zabbix-agent httpd php-fpm[root@zutuanxue ~]# systemctl enable zabbix-server zabbix-agent httpd php-fpm[root@zutuanxue ~]# netstat -ntlp#zabbix_server的端口是10051Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      2106/zabbix_server  tcp6       0      0 :::10051                :::*                    LISTEN      2106/zabbix_server  </code></pre><p>g. 配置Zabbix前端<br>连接到新安装的Zabbix前端： <a href="http://server_ip_or_name/zabbix">http://server_ip_or_name/zabbix</a></p><h2 id="二、站点设置"><a href="#二、站点设置" class="headerlink" title="二、站点设置"></a>二、站点设置</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529129928.png" alt="image20200206131850564.png"></p><p>图：zabbix-web-setup-01</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528792468.png" alt="image20200206132044127.png"></p><p>图：zabbix-web-setup-02</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528835307.png" alt="zabbix_web3.png"></p><p>图：zabbix-web-setup-03</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528855897.png" alt="zabbix_web4.png"></p><p>图：zabbix-web-setup-04</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528868438.png" alt="zabbix_web5.png"></p><p>图：zabbix-web-setup-05</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528880574.png" alt="zabbix_web6.png"></p><p>图：zabbix-web-setup-06</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528902697.png" alt="image20200206132343605.png"></p><p>图：zabbix-web-setup-07</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528915822.png" alt="image20200206132450564.png"></p><p>图：zabbix-web-setup-08</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528929618.png" alt="image20200206132720327.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528945191.png" alt="image20200206132751747.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603528963513.png" alt="image20200206132813412.png"></p><h2 id="三、zabbix-web界面介绍"><a href="#三、zabbix-web界面介绍" class="headerlink" title="三、zabbix web界面介绍"></a>三、zabbix web界面介绍</h2><p>我们现在已经登录了zabbix的页面，并且设置成了中文，那我们一起来看一下这个设置成中文后的界面</p><p>监测—仪表盘</p><p> 在仪表板当中我们可以查看到很多信息，如果感觉信息不够丰富的话，在右上角可以选择编辑仪表盘，添加新的内容。</p><p>可以挨着点一下后面的选项，都是没有内容的，这个我们后面都会说到</p><p>监测—图形</p><p>在这里可以查看各种类型的图表，比如</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529260849.png" alt="image20200206133841844.png"></p><p>通过右上方的时间选项你可以获取到不同时间范围的信息，这就是可持续化的体现，因为这些数据都存放到数据库里面了，但是不管选择哪个时间范围的，你都会发现有乱码，为什么会有乱码？因为没有相关的字库，所以我们要解决乱码的问题</p><p>关于zabbix web设置成中文后图形上的汉字显示乱码问题-解决方案。</p><pre><code>复制本地电脑C:\Windows\Fonts\simkai.ttf（楷体）上传到zabbix服务器[root@zutuanxue ~]# cp SIMKAI.TTF /usr/share/fonts/dejavu/[root@zutuanxue ~]# chmod 644 /usr/share/fonts/dejavu/SIMKAI.TTF [root@zutuanxue ~]# cd /etc/alternatives/[root@zutuanxue alternatives]# rm -fr zabbix-web-font[root@zutuanxue alternatives]# ln -s /usr/share/fonts/dejavu/SIMKAI.TTF /etc/alternatives/zabbix-web-font刷新页面</code></pre><h2 id="四、监控本机"><a href="#四、监控本机" class="headerlink" title="四、监控本机"></a>四、监控本机</h2><p>zabbix默认就是对本机进行监控的，但是一定要开启zabbix-agent服务，在对应的界面，我们可以看到，zabbix的监控有四种：</p><ul><li>ZBX</li><li>SNMP</li><li>JMX</li><li>IPMI</li></ul><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529384793.png" alt="image20200216003900217.png"></p><ul><li>绿色表示正常</li><li>红色则表示有问题<br>如果出现红色了，首先要检查系统中是否安装了zabbix-agent软件包，然后再确认服务是否开启，第三个要检查状态是否已启用。各位可以尝试停止zabbix-agent服务，并且点击一下状态下的已启用按钮改为停用，看一下彻底不好用是什么样的。</li></ul><pre><code>systemctl stop zabbix-agent</code></pre><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529402589.png" alt="image20200216004245599.png"></p><h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><p>安装完zabbix后，已经自带了两个用户</p><ul><li>Admin</li><li>Guests</li></ul><p><strong>超级管理员默认账号：</strong> Admin，密码：zabbix，这是一个超级管理员。</p><p><strong>Guests用户:</strong> 使用guest账号，密码为空，只能看到zabbix后台，没有具体内容。我们可以启用来宾账户，使用来宾账户登录到zabbix页面看一下。</p><p><strong>用户群组：</strong> 群组的增删改查，和权限管理</p><p><strong>用户管理：</strong> 用户增删改查、用户报警媒介管理、用户权限查看。</p><p>要添加一个用户，有三类属性要填写。</p><table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td><strong>用户信息</strong></td><td>账号密码、所属组等基本信息</td></tr><tr><td><strong>示警媒介</strong></td><td>报警相关信息，例如邮箱地址、接受报警时段</td></tr><tr><td><strong>许可权</strong></td><td>权限，当前用户对哪些主机有权限</td></tr></tbody></table><p>zabbix 用户和权限类似windows，用户的有什么权限是组说了算</p><p><strong>案例：</strong> 创建一个群组和用户</p><p><strong>群组创建</strong><br>选择 管理–&gt;用户群组–&gt;创建用户群组</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529646527.png" alt="image20200206152939063.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529662642.png" alt="image20200206153014812.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529674722.png" alt="image20200206153034828.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529685233.png" alt="image20200206153102222.png"></p><p><strong>用户创建</strong></p><p>管理–&gt;用户–&gt;创建用户</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529748943.png" alt="image20200206153449530.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529760946.png" alt="image20200206153539824.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529772009.png" alt="image20200206153750908.png"></p><p>最后再点击添加</p><p>验证用户是否为只读权限</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603529783971.png" alt="image20200206154053192.png"></p><p>由于新建的用户只有只读的权限，所以根本没有“配置”、“管理”字样的选项</p><h1 id="监控案例—监控一台服务器"><a href="#监控案例—监控一台服务器" class="headerlink" title="监控案例—监控一台服务器"></a>监控案例—监控一台服务器</h1><p><strong>案例： 通过监控平台监控一台远端的业务机器</strong></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530035321.png" alt="监控远端机器.png"></p><p>监控方法:zabbix-agent</p><p>监控步骤：</p><p>1、在被监控机安装zabbix-agent客户端服务</p><p>2、修改配置文件指定监控平台</p><p>3、启动服务</p><p>4、zabbix server监控平台添加</p><h3 id="a、部署zabbix-agent监控服务"><a href="#a、部署zabbix-agent监控服务" class="headerlink" title="a、部署zabbix-agent监控服务"></a>a、部署zabbix-agent监控服务</h3><pre><code>#设置源[root@node1 ~]# cat /etc/yum.repos.d/zabbix.repo[zabbix]name=Zabbix Official Repository - $basearch#baseurl=http://repo.zabbix.com/zabbix/4.4/rhel/8/$basearch/baseurl=https://mirrors.aliyun.com/zabbix/zabbix/4.4/rhel/8/$basearch/enabled=1gpgcheck=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591[zabbix-non-supported]name=Zabbix Official Repository non-supported - $basearchbaseurl=http://repo.zabbix.com/non-supported/rhel/8/$basearch/enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIXgpgcheck=0#安装zabbix-agent服务[root@node1 ~]# dnf -y install zabbix-agent</code></pre><h3 id="b、修改配置文件"><a href="#b、修改配置文件" class="headerlink" title="b、修改配置文件"></a>b、修改配置文件</h3><pre><code>[root@node1 ~]# vim /etc/zabbix/zabbix_agentd.conf Server=192.168.98.200      #指定监控平台IP地址</code></pre><h3 id="c、启动服务"><a href="#c、启动服务" class="headerlink" title="c、启动服务"></a>c、启动服务</h3><pre><code>#启动服务[root@node1 ~]# systemctl enable zabbix-agentCreated symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.[root@node1 ~]# systemctl start zabbix-agent</code></pre><h3 id="d、在监控平台添加被监控机器"><a href="#d、在监控平台添加被监控机器" class="headerlink" title="d、在监控平台添加被监控机器"></a>d、在监控平台添加被监控机器</h3><p>配置——主机——创建主机</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530153425.png" alt="zabbix_agent1.png"></p><p>进入创建主机菜单</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530169082.png" alt="zabbix_agent2.png"></p><p>主机名称：可以随便写，但是要有意义，建议按照城市名称+机房名称+主机IP这样比较好识别</p><p>群组：可以理解为业务组</p><p>IP地址：填入被监控机的IP地址</p><p>模板：链接一个监控模板，里面已经设置好了监控项和图形、报警等</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530184146.png" alt="zabbix_agent3.png"></p><p>选择一个适合的模板，这里我们监控的node1是个linux机器，所以我选择的是Template OS Linux模板，注意一定别忘了点击模板下的添加小按钮，将其链接过来</p><p>最后点击下方添加，主机就添加成功了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530197581.png" alt="zabbix_agent4.png"></p><p>稍等一会，等被监控机的可用性ZBX[因为我们是基于zabbix-agent监控的]变成绿色，我们的任务就完成了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530210348.png" alt="zabbix_agent5.png"></p><p>看到标记处变成绿色也就放心了。</p><p>我们可以通过监控——图形来看看是不是有图形了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530223831.png" alt="zabbix_agent6.png"></p><h1 id="自定义监控项"><a href="#自定义监控项" class="headerlink" title="自定义监控项"></a>自定义监控项</h1><p>自定义一个当前登陆用户数量监控脚本</p><h3 id="a、自定一个用户数量收集脚本"><a href="#a、自定一个用户数量收集脚本" class="headerlink" title="a、自定一个用户数量收集脚本"></a>a、自定一个用户数量收集脚本</h3><pre><code>#创建一个插件目录，用于以后存放插件[root@zutuanxue ~]#  mkdir /etc/zabbix/libexec#编写一个统计用户登陆数量的脚本[root@zutuanxue ~]#  cat/etc/zabbix/libexec/check_user_number.sh#!/bin/bash#Description: 登陆用户监控脚本count=`who |wc -l`echo $count#给脚本执行权限[root@zutuanxue ~]#  chmod 755 /etc/zabbix/libexec/check_user_number.sh#测试脚本执行[root@zutuanxue ~]#  /etc/zabbix/libexec/check_user_number.sh1</code></pre><h3 id="b、定义一个键值"><a href="#b、定义一个键值" class="headerlink" title="b、定义一个键值"></a>b、定义一个键值</h3><pre><code>[root@zutuanxue ~]# vim /etc/zabbix/zabbix_agentd.d/check_user_number.confUserParameter=check.user.number,/etc/zabbix/libexec/check_user_number.sh 插件配置文件的格式  指令=kye,value   按照格式写就可以了#重启生效[root@manage01 zabbix]# systemctl restart zabbix-agent</code></pre><p><strong>注意:如果是监控其它主机，请将libexec目录以及zabbix_agentd.d目录下的配置文件都拷贝到远程主机的&#x2F;etc&#x2F;zabbix目录下，并重启zabbix-agent服务</strong></p><h3 id="c、新建一个监控项，调用键值"><a href="#c、新建一个监控项，调用键值" class="headerlink" title="c、新建一个监控项，调用键值"></a>c、新建一个监控项，调用键值</h3><pre><code>注意：如果是希望所有主机都应用该监控项，那么就在对应的模板中创建监控项、图形     如果只是个别机器，那么就针对主机来设置监控项、图形</code></pre><p>给 Template OS Linux 模板添加一个监控项</p><p>依次点击 配置——模板 找到Template OS Linux选项，如图</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530411363.png" alt="自定义监控监控项1.png"></p><pre><code>应用集：   监控项分组监控项：   监控什么触发器：   监控阈值图形：       监控图形自动发现：  自动添加监控业务WEB监测：  监控WEB站点</code></pre><p>点击 监控项，可以看到模板中的所有监控项，该页面可以对模板中的监控项进行管理。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530435453.png" alt="自定义监控监控项2.png"></p><p>点击 创建监控项 后会弹出一个创建监控项菜单，依次填入对应的信息，就可以创建一个自定义的监控项了。<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530451585.png" alt="自定义监控监控项3.png"></p><p>单击 添加后，监控项就添加成功了。</p><p>创建好了监控项不是最终的目的，最终的目的是通过监控项绘制图形，我们可以通过图表能看到信息，接下来我们来为这个监控项创建一个图表吧。</p><p>点击当前界面的图形，就可以进入模板的图表管理界面了，如图</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530465210.png" alt="自定义监控监控项4.png"></p><p>图表管理界面可以对图形就行管理，我们这里选择 创建图形。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530478014.png" alt="自定义监控图形5.png"></p><p>点击创建图形后，就会出现一个创建图形菜单</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530492871.png" alt="自定义监控图形62579308.png"></p><p>根据提示就把图形名称和对应的监控项填入即可。</p><p>图形创建成功了，接下来测试一下吧。</p><p>我们去找一个应用该模板的机器来看看是否有图形，图形是否有数据。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603530507481.png" alt="自定义监控图形7.png"></p><h1 id="Zabbix监控报警"><a href="#Zabbix监控报警" class="headerlink" title="Zabbix监控报警"></a>Zabbix监控报警</h1><p>监控报警机制是我们四要素中的一个重要要素，当机器或者监控资源达到阈值，就应该受到管理员关注。但是那么多的机器靠管理员去用眼睛看肯定是不行的，那么怎么能做到管理员只看有问题的机器呢，大家可能都能想到筛选机制吧！对的，我们把有问题的筛选出来就可以了，怎么筛选呢？那就让监控平台根据触发器筛选出来，并通过邮件、微信、钉钉等方式推送给管理员就可以了，做到有的放矢。</p><p>关于监控报警有很多种方式，常见的有两种</p><p>1）通过本机邮件客户端生成邮件，</p><ul><li><p>通过传输代理发给邮件服务器，</p></li><li><p>通过邮件投递代理发给管理员。</p></li></ul><p>2）三方报警插件：如 onealter</p><p>由于自己配置报警比较复杂，而且邮件容易被拒或当做垃圾邮件。有些专业的报警平台就可以帮你简单实现。</p><p>如:onealeart<br>参考:<a href="https://www.aiops.com/">https://www.aiops.com/</a></p><h2 id="一、onealter安装"><a href="#一、onealter安装" class="headerlink" title="一、onealter安装"></a>一、onealter安装</h2><h3 id="onealter设置"><a href="#onealter设置" class="headerlink" title="onealter设置"></a>onealter设置</h3><p>访问官网</p><p>可以访问<a href="http://www.onealert.com/%EF%BC%9B%E4%B9%9F%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AEhttps://www.aiops.com/%EF%BC%8C%E6%B3%A8%E5%86%8C%E8%B4%A6%E6%88%B7">http://www.onealert.com/；也可以访问https://www.aiops.com/，注册账户</a></p><p>如果访问的是<a href="http://www.onealert.com/%EF%BC%8C%E7%82%B9%E5%87%BB%E5%85%8D%E8%B4%B9%E8%AF%95%E7%94%A8%E4%B9%8B%E5%90%8E%E6%B3%A8%E5%86%8C">http://www.onealert.com/，点击免费试用之后注册</a></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531757916.png" alt="image20200213164140494.png"></p><p>如果访问的是<a href="https://www.aiops.com/%EF%BC%8C%E7%9B%B4%E6%8E%A5%E6%B3%A8%E5%86%8C">https://www.aiops.com/，直接注册</a></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531778720.png" alt="image20200213193407234.png"></p><p>注册一个账号并登陆</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531793906.png" alt="image20200213164226522.png"></p><p>登陆后选择CA</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531813053.png" alt="image20200213164348628.png"></p><p>点击集成–选择zabbix</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531830834.png" alt="image20200213164622598.png"></p><p>可以看到onealter很强大，支持多种监控类型，课程中用的是zabbix，所有我们选项zabbix，然后点击配置。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531851905.png" alt="image20200213164941337.png"></p><p>应用名称：为这个应用起一个名字</p><p>自动关闭时间：如果没有手动关闭告警，多久内自动关闭</p><p>点击保存应获取应用Key,为该应用生成一个key</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603531864612.png" alt="image20200213165138456.png"></p><p>key生成成功了，接下来就要在监控平台按照上述的命令执行安装告警插件了。</p><pre><code>#zabbix 监控平台 插件目录[root@zabbix ~]# mkdir -p /usr/local/zabbix-server/share/zabbix/alertscripts[root@zabbix ~]# cd /usr/local/zabbix-server/share/zabbix/alertscripts#下载监控插件[root@zabbix alertscripts]# wget https://download.aiops.com/ca_agent/zabbix/ca_zabbix_release-2.1.0.tar.gz#安装监控插件[root@zabbix alertscripts]# tar -xzf ca_zabbix_release-2.1.0.tar.gz[root@zabbix alertscripts]# cd cloudalert/bin [root@zabbix bin]# bash install.sh 188728c3-c12b-fd2f-f3fd-bf8eb761e919 ./log.sh:行6: /etc/zabbix/libexec/cloudalert/bin/cloudalert.conf: 没有那个文件或目录start to create config file...##输入交互信息Zabbix管理地址: http://192.168.98.200/zabbixZabbix管理员账号: AdminZabbix管理员密码: ...create action success!安装成功.</code></pre><h2 id="二、onealter-报警插件设置"><a href="#二、onealter-报警插件设置" class="headerlink" title="二、onealter 报警插件设置"></a>二、onealter 报警插件设置</h2><p>告警插件安装成功了，接下来我们要设置告警通知了</p><p>告警通知有多种，比如：邮件、微信、钉钉、APP、电话、短信等</p><p>这里主要给大家介绍：邮件、微信、APP</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532085724.png" alt="image20200213184629351.png"></p><p>点击配置—通知策略进入通知页面</p><p>在这里可以设置邮件报警，同时右侧也给出了APP下载地址，下载后直接安装登陆即可。</p><p>这里我们先把告警状态、告警级别、通知方式、通知人都设置一下。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532099750.png" alt="image20200213194108292.png"></p><p>好了，我点点添加，全部都设置成功了</p><h3 id="添加多个人"><a href="#添加多个人" class="headerlink" title="添加多个人"></a>添加多个人</h3><p><strong>step 1</strong> 为团队添加成员</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532119396.png" alt="image20200213201420457.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532136205.png" alt="image20200213200952058.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532167206.png" alt="image20200213194416754.png"></p><p><strong>step 2</strong> 登录被邀请的用户邮箱选择接受邀请</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532405930.png" alt="image20200213195116050.png"></p><p>可以选择新用户，也可以选择已有账户，完成注册&#x2F;登录的操作后使用被邀请的用户进入到配置中的团队管理界面，看下能否看到两个用户</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532435392.png" alt="image20200213201542249.png"></p><p>如果不可以看到的话就切换到添加成员的界面，刷新一下就可以看到成员已经添加进来了，并且在团队管理中也可以看到响应的用户</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532461447.png" alt="image20200213200626704.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532475611.png" alt="image20200213201741467.png"></p><p><strong>step 3</strong> 在配置，通知策略中可以新建通知了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532516890.png" alt="image20200213202254560.png"></p><p><strong>step 4</strong> 选择保存之后，就可以看到两个用户都有显示了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532561877.png" alt="image20200213202350511.png"></p><p>以上就是单人通知和多人通知的设置方式。</p><p>接下来我们在设置一下微信报警</p><p>点击右上角的人头像—个人中心</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532579455.png" alt="image20200213202703413.png"></p><p>点击绑定微信，使用微信扫描即可绑定。</p><p>好了到此我们的告警插件就设置好了，接下来要设置zabbix-server平台。</p><h2 id="三、zabbix监控平台调用报警插件"><a href="#三、zabbix监控平台调用报警插件" class="headerlink" title="三、zabbix监控平台调用报警插件"></a>三、zabbix监控平台调用报警插件</h2><p><strong>案例: 监控平台调用onealter插件，实现报警</strong></p><p>点击管理—报警媒介类型</p><p>可以看到我们安装好的onealter，我们点击后边的测试，看看是否能正常工作</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603532954403.png" alt="onealter8.png"></p><pre><code>如果测试失败，一般是找不到文件，做个链接[root@manage01 bin]#  ln -s /usr/local/zabbix-server/share/zabbix/alertscripts/cloudalert /usr/lib/zabbix/alertscripts/</code></pre><p>再次测试</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533012961.png" alt="image20200215220103776.png"></p><p>输入收件人地址后，点击测试</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533038982.png" alt="image20200215220148496.png"></p><p>如上图，测试成功了。</p><p>回到zabbix告警平台点击右上角 人头像—报警媒介—添加收件人</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533071992.png" alt="image20200214161626166.png"></p><p>设置告警收件人，可以设置多个人。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533104780.png" alt="image20200214155900052.png"></p><p>ok，我们zabbix监控平台设置好了。</p><h3 id="测试报警"><a href="#测试报警" class="headerlink" title="测试报警"></a>测试报警</h3><p>之前设置过一个自定义监控，我们监控了登陆用户数量，我们通过同时登陆node1超过三个用户，验证报警。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533145726.png" alt="onealter12.png"></p><p>可以看到，node1的当前用户量已经超过了预警值</p><p>看看邮箱吧，是否收到报警</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533167741.png" alt="image20200214155944190.png"></p><p>当你把多余的用户退出以后还会收到邮件</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/24/1603533227451.png" alt="image20200214161309486.png"></p><p>测试成功。</p><h1 id="Zabbix分布式监控"><a href="#Zabbix分布式监控" class="headerlink" title="Zabbix分布式监控"></a>Zabbix分布式监控</h1><p>生产环境中，我们为了实现地域容灾，我们会把服务器放在不同的地域，如果一台zabbix server去监控的话，延迟会高，因为中国的网络由很多运营商在经营，包括联通，移动，电信，教育等等，有玩游戏的同学应该清楚，家里是联通的网络，你去会去电信的服务器么？不会，因为延迟太高。为什么延迟高？因为运营商之间的出口带宽是有限制的，为什么有限制？因为费用不一样，你在便宜的运营商这里办宽带，在贵的运营商这里玩，这种事，换做是谁都不会高兴的。有的同学说我用游戏加速器怎么延迟就低了？使用游戏加速器相当于在大家都从一扇门进出的时候，你发现了一扇窗，而这扇窗就你自己在用，但是当其他人也发现了这扇窗之后呢？所以即便是使用了游戏加速器，在上网高峰时，延迟还是高，只不过没有那么拥挤而已。说完了为什么延迟会高，我们再看一下另外一个问题，这种把服务器放在不同的地域也会造成zabbix server压力也会很大，所以为了避免这种情况，我们的处理方法就是将权利下发，在不同的地域都找一个机器来充当代理，本地的监控工作由代理(proxy)来完成，代理完成收集工作后交给zabbix server，zabbix server在将收到的数据统一整理展示到web。</p><p>其实这个例子很简单就是你开了很多分公司，你一个人去管理这些分公司的员工的话，你是管不全面的，所以我们的方法是在每个分公司弄一个负责人，负责人管当地的员工，你管负责人。有问题他们集中向你汇报就好了。这样你就能很顺利的掌控全局了。</p><p><strong>架构图</strong></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593373704.png" alt="image20200219101305467.png"></p><p>所以在这个分布式监控的架构中的流程是</p><p>1、zabbix server发布指令给代理</p><p>2、zabbix-proxy将指令发给被监控主机</p><p>3、被监控机将数据汇报给zabbix-proxy</p><p>4、zabbix-proxy再交给zabbix-server</p><p>5、zabbix-server将数据展示</p><p>这样解决了延迟问题，只要保证一条线路畅通就可以了，至于保证一条线路畅通的手段就看你的公司了，有钱可以接专线，没钱可以使用VPN，实在不行可以直接走广域网</p><h3 id="实验拓扑图"><a href="#实验拓扑图" class="headerlink" title="实验拓扑图"></a>实验拓扑图</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593518849.png" alt="zabbix_proxy.png"></p><p>在这个架构中我们至少需要三台机器，他们的角色为</p><ul><li><strong>zabbix-server：</strong> 192.168.98.200</li><li><strong>zabbix-proxy：</strong> 192.168.98.205</li><li><strong>被监控主机：</strong> 192.168.98.xxx</li></ul><h3 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h3><p>部署server监控平台 (略)</p><p>部署proxy代理平台</p><p>被监控机安装zabbix-agent（略）</p><h2 id="一、部署zabbix-proxy代理平台"><a href="#一、部署zabbix-proxy代理平台" class="headerlink" title="一、部署zabbix-proxy代理平台"></a>一、部署zabbix-proxy代理平台</h2><h3 id="1-1、安装zabbix-proxy平台"><a href="#1-1、安装zabbix-proxy平台" class="headerlink" title="1.1、安装zabbix-proxy平台"></a>1.1、安装zabbix-proxy平台</h3><pre><code>#设置yum源[root@proxy ~]# cat &gt;&gt; /etc/yum.repos.d/zabbix.repo &lt;&lt;EOF[zabbix]name=Zabbix Official Repository - $basearchbaseurl=http://repo.zabbix.com/zabbix/4.4/rhel/8/$basearch/#baseurl=https://mirrors.aliyun.com/zabbix/zabbix/4.4/rhel/8/$basearch/enabled=1gpgcheck=0gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX-A14FE591[zabbix-non-supported]name=Zabbix Official Repository non-supported - $basearchbaseurl=http://repo.zabbix.com/non-supported/rhel/8/$basearch/enabled=1gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIXgpgcheck=0#安装软件包[root@proxy ~]# dnf -y install mariadb-server mariadb zabbix-proxy-mysql zabbix-agent############################################################注意：如果无法连接公网的源，可以用浏览器将软件包下载到本地，然后自己创建本地源step1[root@proxy ~]# dnf install createrepo -ystep2[root@proxy ~]# createrepo zabbix/（此路径为存放软件包的路径）step3[root@proxy ~]# vim /etc/yum.repos.d/server.repo [server-app]name=server-appenable=1gpgcheck=0baseurl=file:///mnt/AppStream[server-os]name=server-osenable=1gpgcheck=0baseurl=file:///mnt/BaseOS[zabbix]name=zabbixenabled=1gpgcheck=0baseurl=file:///root/zabbixstep4[root@proxy ~]# dnf -y install mariadb-server mariadb zabbix-proxy-mysql zabbix-agent#############################################################mariadb设置#启动服务[root@proxy ~]# systemctl enable mariadbCreated symlink from /etc/systemd/system/multi-user.target.wants/mariadb.service to /usr/lib/systemd/system/mariadb.service.[root@proxy ~]# systemctl start mariadb[root@proxy ~]# mysqladmin -u root password &#39;123456&#39;#创建数据库 zabbix_proxy及管理用户[root@proxy ~]# mysql -u root -pMariaDB [(none)]&gt; create database zabbix_proxy character set utf8 collate utf8_bin;Query OK, 1 row affected (0.00 sec)MariaDB [(none)]&gt;  grant all privileges on zabbix_proxy.* to zabbix@localhost identified by &#39;123456&#39;;Query OK, 0 rows affected (0.00 sec)MariaDB [(none)]&gt; flush privileges;Query OK, 0 rows affected (0.00 sec)MariaDB [(none)]&gt; exitBye#导入数据[root@proxy ~]# zcat /usr/share/doc/zabbix-proxy-mysql/schema.sql.gz |mysql -u zabbix -p123456 zabbix_proxy</code></pre><h3 id="1-2、修改proxy配置文件"><a href="#1-2、修改proxy配置文件" class="headerlink" title="1.2、修改proxy配置文件"></a>1.2、修改proxy配置文件</h3><pre><code>[root@proxy ~]# egrep &quot;^(Server|Hostname|DBPass)&quot; /etc/zabbix/zabbix_proxy.conf Server=192.168.98.200#将数据汇报给谁Hostname=zabbix_proxy#自己的名字DBPassword=123456#数据库密码</code></pre><h3 id="1-3、关于proxy的监控问题"><a href="#1-3、关于proxy的监控问题" class="headerlink" title="1.3、关于proxy的监控问题"></a>1.3、关于proxy的监控问题</h3><p>由于proxy既是监控也是被监控机，所以本机的agent的服务器地址可以设置本机或者server地址，这里建议设置server地址。因为这样zabbix server能够直接监控到本机的状态</p><pre><code>[root@proxy ~]# egrep &quot;^(Server|Hostname)&quot; /etc/zabbix/zabbix_agentd.conf Server=192.168.98.200ServerActive=192.168.98.200Hostname=proxy </code></pre><h3 id="1-4、启动服务"><a href="#1-4、启动服务" class="headerlink" title="1.4、启动服务"></a>1.4、启动服务</h3><pre><code>[root@proxy ~]# systemctl enable zabbix-proxy zabbix-agentCreated symlink from /etc/systemd/system/multi-user.target.wants/zabbix-proxy.service to /usr/lib/systemd/system/zabbix-proxy.service.Created symlink from /etc/systemd/system/multi-user.target.wants/zabbix-agent.service to /usr/lib/systemd/system/zabbix-agent.service.[root@proxy ~]# systemctl start zabbix-proxy zabbix-agent</code></pre><p>查看一下日志显示的内容，以及确认下端口是否打开</p><pre><code>[root@proxy ~]# tail -f /var/log/zabbix/zabbix_proxy.log34539:20200215:133633.989 proxy #13 started [history syncer #2] 34547:20200215:133633.990 proxy #21 started [poller #4] 34548:20200215:133633.996 proxy #22 started [poller #5] 34546:20200215:133633.998 proxy #20 started [poller #3] 34551:20200215:133634.000 proxy #25 started [preprocessing manager #1] 34550:20200215:133634.003 proxy #24 started [icmp pinger #1] 34549:20200215:133634.003 proxy #23 started [unreachable poller #1] 34552:20200215:133635.011 proxy #26 started [preprocessing worker #1] 34554:20200215:133635.014 proxy #28 started [preprocessing worker #3] 34553:20200215:133635.019 proxy #27 started [preprocessing worker #2] 34534:20200215:133641.038 cannot send proxy data to server at &quot;192.168.98.200&quot;: proxy &quot;zabbix_proxy&quot; not found 34534:20200215:133642.041 cannot send proxy data to server at &quot;192.168.98.200&quot;: proxy &quot;zabbix_proxy&quot; not found 34534:20200215:133643.044 cannot send proxy data to server at &quot;192.168.98.200&quot;: proxy &quot;zabbix_proxy&quot; not found 34534:20200215:133644.046 cannot send proxy data to server at &quot;192.168.98.200&quot;: proxy &quot;zabbix_proxy&quot; not found 34534:20200215:133645.049 cannot send proxy data to server at &quot;192.168.98.200&quot;: proxy &quot;zabbix_proxy&quot; not found[root@proxy ~]# netstat -ntlp Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      33953/zabbix_agentd tcp        0      0 0.0.0.0:10051           0.0.0.0:*               LISTEN      33960/zabbix_proxy  tcp6       0      0 :::10050                :::*                    LISTEN      33953/zabbix_agentd tcp6       0      0 :::10051                :::*                    LISTEN      33960/zabbix_proxy  tcp6       0      0 :::3306                 :::*                    LISTEN      33219/mysqld        </code></pre><p>通过查看日志，我们发现日志当中好像有报错，这个我们一会再说，通过查看端口可以发现zabbix_proxy与zabbix_server使用的端口是一样的，所以这两个角色不能配置在一台主机上</p><h3 id="1-5、监控平台设置"><a href="#1-5、监控平台设置" class="headerlink" title="1.5、监控平台设置"></a>1.5、监控平台设置</h3><p>刚才我们在查看日志的时候发现日志中好像有错误提示，这个提示产生的原因就是服务端不认这个代理，代理给服务端发数据，服务端不要，所以我们要告诉服务端，它的代理是谁</p><p>管理—agent代理程序</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593691636.png" alt="zabbixproxy1.png"></p><p>选择 创建代理 进入代理设置模式</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593701268.png" alt="zabbixproxy2.png"></p><p>设置代理名称:一定要和proxy配置文件中的Hostname一致</p><p>设置代理模式：主动</p><p>1）proxy主动模式</p><p>zabbix_proxy主动发数据给zabbix_server(proxy的默认模式)</p><pre><code># vim /etc/zabbix/zabbix_proxy.confProxyMode=0--此参数为0表示proxy主动模式</code></pre><p>2）proxy被动模式</p><p>zabbix_server找zabbix_proxy为收集数据</p><pre><code># vim /etc/zabbix/zabbix_proxy.confProxyMode=1   --此参数为1表示proxy主动模式  </code></pre><p>警告</p><pre><code>为了避免服务端不识别代理或者其它主机的情况，建议在zabbix_server最好给代理名字及其它主机做个解析[root@zabbix ~]# vim /etc/hosts192.168.98.205  proxy zabbix_proxy </code></pre><h2 id="二、设置被监控机"><a href="#二、设置被监控机" class="headerlink" title="二、设置被监控机"></a>二、设置被监控机</h2><pre><code>[root@node4 ~]# egrep &quot;^(Server|Hostname)&quot; /etc/zabbix/zabbix_agentd.conf Server=192.168.98.205ServerActive=192.168.98.205Hostname=node4[root@node4 ~]#  systemctl restart zabbix-agent[root@node2 ~]# netstat -ntlp Active Internet connections (only servers)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name     tcp        0      0 0.0.0.0:10050           0.0.0.0:*               LISTEN      7836/zabbix_agentd  tcp6       0      0 :::10050                :::*                    LISTEN      7836/zabbix_agentd  </code></pre><h2 id="三、验证"><a href="#三、验证" class="headerlink" title="三、验证"></a>三、验证</h2><p>由于之前配置过自动注册，所以应该在主机列表中能看到就算成功了。</p><p>配置—主机</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593756229.png" alt="image20200215140100181.png"></p><p>看到了，node2后面有一个zabbix_proxy 说明该主机走的是代理模式。</p><p>如果查看监测–图形时很久不出图，建议分别重启zabbix_proxy和客户端的zabbix-proxy以及zabbix-agent服务</p><h1 id="模板管理"><a href="#模板管理" class="headerlink" title="模板管理"></a>模板管理</h1><p><strong>模板(template)</strong>: 对于我们来说是非常重要的，因为它保存了监控项，应用集（给监控项分的组），触发器，图形，聚合图形，自动发现规则，web监测等的一组实体。最主要的是给懒人们提供了方便</p><p>我们使用模板可以方便应用到主机，更改模板也会将更改应用到所有链接的主机。避免了每一台主机都需要手动去添加，手动去更改的麻烦</p><p>参考: <a href="https://www.zabbix.com/documentation/3.4/zh/manual/config/templates">https://www.zabbix.com/documentation/3.4/zh/manual/config/templates</a></p><p>在工作中，我们也可以根据自己公司的实际情况去创建模板，然后将目标应用到公司的服务器上去</p><h2 id="一、创建一个模板"><a href="#一、创建一个模板" class="headerlink" title="一、创建一个模板"></a>一、创建一个模板</h2><p>配置—模板</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593961462.png" alt="模板1.png"></p><p>点击创建模板进入模板菜单</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593971773.png" alt="模板2.png"></p><p>模板创建成功后，需要设置模板中的相关属性</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603593979759.png" alt="模板3.png"></p><p>由于我们之前修改过系统自带的模板，我们现在把他还原，也就是把之前我们添加的那个查看用户数量的相关信息都删除，然后再将监控用户数量这个设置添加到自己的模板中</p><p>首先找到之前添加的位置</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594059969.png" alt="image20200215142907258.png"></p><p>选择“监控项”把之前我们手动添加的内容并删除</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594004364.png" alt="image20200215143108427.png"></p><p>注意：如果是先删除“监控项”中的记录，那么“触发器”和“图形”中的也会跟着删除，如果是先删除“触发器”和“图形”中的记录，一定要记得回到“监控项”中将记录删除，删除完成之后，找到我们自己的模板选择监控项</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594087710.png" alt="image20200215153151362.png"></p><p>然后我们创建一个监控项</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594114851.png" alt="image20200215153833443.png"></p><p>监控项添加好了我们接着添加图形</p><p>点击图形–创建图形</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594145519.png" alt="image20200215154057905.png"></p><p>接下来是触发器–创建触发器</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594169936.png" alt="image20200215154323984.png"></p><p>设置完成之后点击“插入”和“添加”</p><p>现在这个模板我就定义完成了，那这个模板怎么使用呢？</p><p>直接点击配置–主机，选择node2</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594203095.png" alt="image20200215155458753.png"></p><p>然后选择模板，取消并清理，选择我们自己创建的模板，点击更新</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594219316.png" alt="image20200215155614926.png"></p><p>然后你就可以看到了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594230717.png" alt="image20200215155638220.png"></p><p>切换到监测–图形就可以查看到图形内容了</p><pre><code>注意：设置完成之后建议重新启动zabbix-proxy和zabbix-agent服务，如果是新的主机，新的主机上要存在相关的脚本和配置文件，相关操作还记得吧mkdir /etc/zabbix/libexeccat/etc/zabbix/libexec/check_user_number.sh#!/bin/bash#Description: 登陆用户监控脚本count=`who |wc -l`echo $countchmod 755 /etc/zabbix/libexec/check_user_number.sh/etc/zabbix/libexec/check_user_number.shvim /etc/zabbix/zabbix_agentd.d/check_user.confUserParameter=check.user,/etc/zabbix/libexec/check_user_number.sh systemctl restart zabbix-agent zabbix-proxy</code></pre><h2 id="二、导出一个模板"><a href="#二、导出一个模板" class="headerlink" title="二、导出一个模板"></a>二、导出一个模板</h2><p>导入导出模式是一个非常好的功能，在一台监控主机上的设置如果想用再其它监控主机而不想从头建立模板的时候，就需要用到这个功能</p><p><strong>导入导出</strong>可以帮你轻松实现，导出的是<strong>xml</strong>格式文件.</p><p>配置－－主机－－选取要导出的主机（前面打勾）－－下面选择导出</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594286591.png" alt="image20200215175546553.png"></p><p>各位要注意，导出的只是模板，如果想拿到其它主机上使用的话，模板里面所涉及到的key，插件也需要一起保存，所谓的插件就是存放在&#x2F;etc&#x2F;zabbix&#x2F;libexec目录下的内容，而key就是存放在&#x2F;etc&#x2F;zabbix&#x2F;zabbix_agent.d&#x2F;*.conf文件</p><h2 id="三、导入一个模板"><a href="#三、导入一个模板" class="headerlink" title="三、导入一个模板"></a>三、导入一个模板</h2><p>你可以在网上下载好zabbix的监控模板，下载的时候记得把相关的key文件和插件文件一同下载,下载完成之后将对应的key文件和插件拷贝到对应目录</p><p>在被监控主机上添加key和插件</p><pre><code>[root@node2 ~]# cd znginx-master/[root@node2 znginx-master]# lsReadme.txt  userparameter_znginx.conf.sample  zbx_export_templates.xml  znginx[root@node2 znginx-master]# cp znginx /etc/zabbix/libexec/[root@node2 znginx-master]# cp userparameter_znginx.conf.sample /etc/zabbix/zabbix_agentd.d/[root@node2 znginx-master]# cd /etc/zabbix/zabbix_agentd.d/[root@node2 zabbix_agentd.d]# mv userparameter_znginx.conf.sample userparameter_znginx.conf</code></pre><p>配置—模板—导入</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594316548.png" alt="image20200215182702772.png"></p><p>点击导入文件部分的按钮，选择对应的xml文件，点击导入</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594328789.png" alt="image20200215182818104.png"></p><p>返回模板中看下是否有新导入的模板</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594344461.png" alt="image20200215182935259.png"></p><p>然后你就可以正常使用了</p><p>注意：在导入过程中记得选择xml文件，而下载模板文件的时候注意版本跨度不要太大，否则模板会无法正常使用。</p><h1 id="Zabbix主动监控和被动监控"><a href="#Zabbix主动监控和被动监控" class="headerlink" title="Zabbix主动监控和被动监控"></a>Zabbix主动监控和被动监控</h1><p>zabbix在监控的时候有两种模式，一种是主动模式，另外一种是被动模式</p><h2 id="一、被动模式"><a href="#一、被动模式" class="headerlink" title="一、被动模式"></a>一、被动模式</h2><p>所谓的被动模式，是以zabbix-agent做为参考对象，也就是表示是server或proxy去找agent拿数据，agent被动的等待指令的下达，让我干什么活，我就去干什么活，这也是zabbix server的默认模式，为什么这么说？我们可以随便找一台主机的查看它的监控项中在名称下面有一个类型，在这里面我们看到的是“zabbix客户端”这个值</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/25/1603594519820.png" alt="image20200215184213711.png"></p><p>这个值在已经设置好的监控项当中是不能更改的，但是如果我们新建监控项的时候你就会发现，类型里面还有一个叫“zabbix客户端（主动式）”的选项。所以说zabbix默认的都是被动模式</p><p>配置方法如下:</p><pre><code>agent端配置被动模式的参数如下[root@agent1 ~]# vim /etc/zabbix/zabbix_agentd.confServer=10.1.1.13--IP为zabbix_proxy的ip(如果没有proxy，则直接为zabbix_server的ip)[root@agent1 ~]# systemctl restart zabbix-agent</code></pre><h2 id="二、主动模式"><a href="#二、主动模式" class="headerlink" title="二、主动模式"></a>二、主动模式</h2><p>也就是agent主动把数据传给server或proxy</p><p>agent主动模式的优点是: 当agent太多的情况下，server或proxy去找这么多agent搜集数据，压力负载过大。用主动模式就可以缓解server或proxy的压力。</p><p>但用主动模式的问题是: 监控项当中的类型，也要转为主动式才行，而且很多zabbix自带模板里的监控项不支持转为主动式.</p><pre><code>agent端配置主动模式的参数如下[root@agent1 ~]# vim /etc/zabbix/zabbix_agentd.confServeractive=10.1.1.13 --IP为zabbix_proxy的ip(如果没有proxy，则直接为zabbix_server的ip)[root@agent1 ~]# systemctl restart zabbix-agent</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络</title>
      <link href="/2023/05/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
      <url>/2023/05/08/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h1><h2 id="一、IP介绍"><a href="#一、IP介绍" class="headerlink" title="一、IP介绍"></a>一、IP介绍</h2><p>IP是英文Internet Protocol的缩写，意思是“网络之间互连的协议”，也就是为计算机网络相互连接进行通信而设计的协议。在因特网中，它是能使连接到网上的所有计算机网络实现相互通信的一套规则，规定了计算机在因特网上进行通信时应当遵守的规则。任何厂家生产的计算机系统，只要遵守IP协议就可以与因特网互连互通。正是因为有了IP协议，因特网才得以迅速发展成为世界上最大的、开放的计算机通信网络。因此，IP协议也可以叫做“因特网协议”。</p><p>IP地址是指互联网协议地址，IP地址是IP协议提供的一种统一的地址格式，它为互联网上的每一个网络和每一台主机分配一个逻辑地址。大家日常见到的情况是每台联网的PC上都需要有IP地址，才能正常通信。我们可以把“个人电脑”比作“一台电话”，那么“IP地址”就相当于“电话号码”，而Internet中的路由器，就相当于电信局的“程控式交换机”。</p><pre><code>IP是一个协议，是计算机在网络中互联互通的规则IP地址是IP实现互联互通的一个策略</code></pre><h3 id="IP地址和Mac地址"><a href="#IP地址和Mac地址" class="headerlink" title="IP地址和Mac地址"></a>IP地址和Mac地址</h3><p>IP地址是软件地址，而不是硬件地址。硬件地址被硬编码到网络接口卡(NIC)中，用于在本地 网络中寻找主机。 IP地址让一个网络中的主机能够与另一个网络中的主机通信，而不管这些主机所属的LAN是什么类型的。</p><pre><code>MAC用于局域网中通信，交换机通过mac地址将数据包转发到正确的计算机IP用于网络间通信</code></pre><h3 id="IP地址分类"><a href="#IP地址分类" class="headerlink" title="IP地址分类"></a>IP地址分类</h3><p>IPV4:32位二进制 以点分割，分为4段十进制数 a.b.c.d</p><p>IPV6:128位二进制 以冒号分割,分为8段十六进制数 a🅱️c:d:e:f:g:h</p><h2 id="二、IPV4地址"><a href="#二、IPV4地址" class="headerlink" title="二、IPV4地址"></a>二、IPV4地址</h2><p>IPV4地址长 32位，这些位被划分成 4组(称为字节或八位组)，每组8位,每组最大不超过255，我们可使用下面3种方法描述IP地址:</p><p>点分十进制表示，如 192.168.0.1。</p><p>二进制，如 11000000.10101000.00000000.00000001</p><p>十六进制，如 c0.a8.0.1。</p><p>上述示例表示的是同一个IP地址。对于IP编址时，十六进制表示没有点分十进制和二进制那样常用，但某些程序确实以十六进制形式存储IP地址， Windows注册表就将机器的IP地址存储为十六进制。</p><h3 id="IPV4地址分类"><a href="#IPV4地址分类" class="headerlink" title="IPV4地址分类"></a>IPV4地址分类</h3><p>按照第一段的范围分类</p><p>A 1-126</p><p>B 128-191</p><p>C 192-223</p><p>D 224-239</p><p>E 240-255</p><p>设计因特网的人决定根据网络规模创建网络类型。对于少量包含大量节点的网络，他们创建了A类网络;对于另一种极端情况的网络，他们创建了C类网络，用来指示大量只包含少量节点的网络; 介于超大型和超小型网络之间的是B类网络。所以IPV4五类地址中只有前三类可以分给用户试用，D类是多播地址，E类为保留地址，用于研究。</p><p>网络的类型决定了 IP地址将如何划分成网络部分和节点部分</p><h3 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h3><p>子网掩码：区分IP地址的网络位和主机位</p><p>255.0.0.0</p><p>255.255.0.0</p><p>255.255.255.0</p><p>255.255.255.255</p><p>网络位:掩码对应的IP位的二进制部分，全为1的部分是网络位</p><p>主机位:掩码对应的IP位的二进制部分，不全为1的部分是主机位</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024638647.png" alt="网络位与主机位.png"></p><h3 id="进制转换方法"><a href="#进制转换方法" class="headerlink" title="进制转换方法"></a>进制转换方法</h3><p>十进制转二进制: 除2取余倒着念</p><p>十进制转八进制: 除8取余倒着念</p><p>十进制转十六进制: 除16取余倒着念</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601026468125.png" alt="进制转换.png"></p><h3 id="8421法则转换法"><a href="#8421法则转换法" class="headerlink" title="8421法则转换法"></a>8421法则转换法</h3><pre><code>把要转换的十进制数按照下列数累加，用的的写1没用的的写0128      64      32      16    8     4   2   1比如：十进制数132转换为二进制128      64      32      16    8     4   2   11         0      0       0     0     1   0   0因为132=128+4所以十进制数132转换为二进制是&quot;10000100</code></pre><h3 id="私网地址"><a href="#私网地址" class="headerlink" title="私网地址"></a>私网地址</h3><p>由于互联网的蓬勃发展，IP位址的需求量愈来愈大，使得IP位址的发放愈趋严格，各项资料显示全球IPv4位址可能在2005至2010年间全部发完(实际情况是在2011年2月3日IPv4位地址分配完毕）。</p><p>为了解决IP地址不足，又设计了私有地址，这样就可以重复在局域网中使用了，LAN中的用户想上网只需通过PNAT的方式通过地址转换技术就可以上网，保证了公网地址的最大化、最高效应用。</p><p>A类地址中私网10.0.0.0–10.255.255.255</p><p>B类地址中私网172.16.0.0.0–172.31.255.255</p><p>C类地址中私网192.168.0.0–192.168.255.255</p><h3 id="PNAT技术"><a href="#PNAT技术" class="headerlink" title="PNAT技术"></a>PNAT技术</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601026081212.png" alt="LAN_NAT_WAN.png"></p><h3 id="IP分配原则"><a href="#IP分配原则" class="headerlink" title="IP分配原则"></a>IP分配原则</h3><p>只有A、B、C三类地址可以分配给计算机和网络设备</p><p>网络地址相同主机地址必须唯一</p><p>网络地址的第一个数字不能为127，保留用来测试连接</p><p>网络地址不能全为0，也不能全为1.</p><p>主机地址中不能全为0，也不能全为1：主机地址全为0用来表示网络地址，全为1用作广播</p><p><strong>ipv4特殊IP，不能使用的IP：</strong></p><p>0.0.0.0</p><p>255.255.255.255</p><p>127.x.x.x</p><p>A.0.0.0、A.255.255.255</p><p>169.254.0.0–168.254.255.255</p><h2 id="三、IPv6地址"><a href="#三、IPv6地址" class="headerlink" title="三、IPv6地址"></a>三、IPv6地址</h2><p>由于IPv4最大的问题在于网络地址资源有限，严重制约了互联网的应用和发展。IPv6的使用，不仅能解决网络地址资源数量的问题，而且也解决了多种接入设备连入互联网的障碍</p><p>互联网数字分配机构（IANA）在2016年已向国际互联网工程任务组（IETF）提出建议，要求新制定的国际互联网标准只支持IPv6，不再兼容IPv4。</p><h3 id="IPV6组成"><a href="#IPV6组成" class="headerlink" title="IPV6组成"></a>IPV6组成</h3><p>IPv6的地址长度为128位，是IPv4地址长度的4倍。于是IPv4点分十进制格式不再适用，采用十六进制表示。</p><h3 id="IPV6分类"><a href="#IPV6分类" class="headerlink" title="IPV6分类"></a>IPV6分类</h3><p>单播地址（Unicast Address）</p><pre><code>用来唯一标识一个接口，类似于IPv4中的单播地址。发送到单播地址的数据报文将被传送给此地址所标识的一个接口。</code></pre><p>组播地址（Multicast Address）</p><pre><code>用来标识一组接口（通常这组接口属于不同的节点），类似于IPv4中的组播地址。发送到组播地址的数据报文被传送给此地址所标识的所有接口。</code></pre><p>任播地址（Anycast Address）</p><p>用来标识一组接口（通常这组接口属于不同的节点）。发送到任播地址的数据报文被传送给此地址所标识的一组接口中距离源节点最近（根据使用的路由协议进行度量）的一个接口，一对最近。</p><p>单播地址</p><p>可聚合的全球单播地址（Aggregatable Global Unicast Addresses）</p><pre><code>可在全球范围内路由和到达的，相当于IPv4里面的global addresses。前三个bit是001例如：2000::1:2345:6789:01ab</code></pre><p>链路本地地址（Link-Local Addresses）</p><pre><code>用于同一个链路上的相邻节点之间通信，相当于IPv4里面的169.254.0.0/16地址。Ipv6的路由器不会转发链路本地地址的数据包。前10个bit是1111 1110 10，由于最后是64bit的interface ID，所以它的前缀总是FE80::/64例如：FE80::1/10</code></pre><p>站点本地地址（Site-Local Addresses）</p><pre><code>对于无法访问internet的本地网络，可以使用站点本地地址，这个相当于IPv4里面的private address（10.0.0.0/8, 172.16.0.0/12, and 192.168.0.0/16）。它的前10个bit是1111 1110 11，它最后是16bit的Subnet ID和64bit的interface ID，所以它的前缀是FEC0::/48。</code></pre><p>未指定地址（Unspecified address）</p><pre><code>0:0:0:0:0:0:0:0 或者::当一个有效地址还不能确定，一般用未指定地址作为源地址。未指定地址不能作为一个目标地址来使用。</code></pre><p>回环地址（Loopback address）</p><pre><code>回环地址::1用于标识一个回环接口，可以使一个节点可以给自己发送数据包。相当于IPv4的回环地址127.0.0.1</code></pre><p>唯一的本地单播地址（ULA，Unique Local IPv6 Unicast Address）</p><pre><code>在RFC4193中标准化了一种用来在本地通信中取代单播站点本地地址的地址。ULA拥有固定前缀FC00::/7，后面跟一个被称为全局ID的40bit随机标识符</code></pre><h3 id="IPV6特殊地址"><a href="#IPV6特殊地址" class="headerlink" title="IPV6特殊地址"></a>IPV6特殊地址</h3><p>下面列出一些绝对应该牢记的地址范围，因为我们总是会用到它们。它们都是特殊地址或保留用 于特定目的的地址，但不同于 IPv4， IPv6提供的地址非常多，因此保留一些不会有任何害处。</p><p>0:0:0:0:0:0:0:0 (::)相当于 IPv4地址 0.0.0札通常在使用有状态 DHCP配置时，用作主机 的源地址。</p><p>0:0:0:0:0:0:0:1 (::1) 相当于 IPv4地址 127.0.0.10</p><p>0:0:0:0:0:0:192.168.100.1 在同时支持 IP4和IPv6的网络中，从 IPv4地址转换而来的IPv6地址通常这样书写。</p><p>2000::&#x2F;3 全局单播地址范围。</p><p>FCOO::厅唯一的本地单播地址范围。</p><p>FE80::&#x2F;10 链路本地单播地址范围。</p><p>FFOO::&#x2F;8 组播地址范围。</p><p>3FFF:FFFF::&#x2F;32 保留举例和编写文档时使用。</p><p>2001:0088::&#x2F;32 保留举例和编写文档时使用。</p><p>2002::&#x2F;16 保留供 6t04隧道技术使用。 6t04隧道技术是一种从IPv4迁移到IPv6的方法，让IPv6分组能够通过IPv4 网络进行传输，而无需配置显式的隧道。</p><pre><code>IPV6为啥这么多年没广泛应用网络黑白名单需要时间去建立，否则网络威胁无法解决。目前骨干线路已经全部使用了IPV6地址，随着物联网的出现，IPV6会更快完成替换。</code></pre><h2 id="四、VLSM可变长子网掩码"><a href="#四、VLSM可变长子网掩码" class="headerlink" title="四、VLSM可变长子网掩码"></a>四、VLSM可变长子网掩码</h2><p>VLSM(可变长子网掩码) 提供了在一个主类(A类、B类、C类)网络内包含多个子网的能力，可以对一个子网再进行子网划分,使IP地址得到最充分的利用.</p><h3 id="划分子网"><a href="#划分子网" class="headerlink" title="划分子网"></a>划分子网</h3><p>就是借用主机号的位充当网络号来扩大网络的个数</p><h3 id="VLSM优点"><a href="#VLSM优点" class="headerlink" title="VLSM优点"></a>VLSM优点</h3><p>VLSM技术可以避免固定长度子网掩码浪费地址空间的问题。</p><p>提高带宽利用率</p><p>实现LAN中的网络隔离，更加安全。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601026370058.png" alt="VLSM.png"></p><h1 id="OSI七层网络模型"><a href="#OSI七层网络模型" class="headerlink" title="OSI七层网络模型"></a>OSI七层网络模型</h1><h2 id="一、OSI七层模型介绍"><a href="#一、OSI七层模型介绍" class="headerlink" title="一、OSI七层模型介绍"></a>一、OSI七层模型介绍</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601023863056.png" alt="osi七层模型简图.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601023885728.gif" alt="osi七层.gif"></p><p><strong>应用层</strong></p><p>网络服务与最终用户的一个接口。</p><p>协议有：HTTP FTP TFTP SMTP SNMP DNS TELNET HTTPS POP3 DHCP</p><p><strong>表示层</strong></p><p>数据的表示、安全、压缩。（在五层模型里面已经合并到了应用层）</p><p>格式有，JPEG、ASCll、DECOIC、加密格式等</p><p><strong>会话层</strong></p><p>建立、管理、终止会话。（在五层模型里面已经合并到了应用层）</p><p>对应主机进程，指本地主机与远程主机正在进行的会话</p><p><strong>传输层</strong></p><p>定义传输数据的协议端口号，以及流控和差错校验。</p><p>协议有：TCP UDP，数据包一旦离开网卡即进入网络传输层</p><p><strong>网络层</strong></p><p>进行逻辑地址寻址，实现不同网络之间的路径选择。</p><p>协议有：ICMP IGMP IP（IPV4 IPV6） ARP RARP</p><p><strong>数据链路层</strong></p><p>建立逻辑连接、进行硬件地址寻址、差错校验 [2] 等功能。（由底层网络定义协议）</p><p>将比特组合成字节进而组合成帧，用MAC地址访问介质，错误发现但不能纠正。</p><p><strong>物理层</strong></p><p>建立、维护、断开物理连接。（由底层网络定义协议）</p><pre><code>关于设备工作在哪一层！一个设备工作在哪一层，关键看它工作时利用哪一层的数据头部信息。网桥工作时，是以MAC头部来决定转发端口的，因此显然它是数据链路层的设备。具体说:物理层：网卡，网线，集线器，中继器，调制解调器数据链路层：网桥，交换机网络层：路由器</code></pre><h2 id="二、OSI七层特点"><a href="#二、OSI七层特点" class="headerlink" title="二、OSI七层特点"></a>二、OSI七层特点</h2><p>OSI七层由于太过严格，所以并没有应用在计算机中，而是基于其衍生了一个TCP&#x2F;IP四层模型，被广大操作系统所应用。</p><h1 id="TCP、IP四层网络模型"><a href="#TCP、IP四层网络模型" class="headerlink" title="TCP、IP四层网络模型"></a>TCP、IP四层网络模型</h1><h2 id="一、TCP-IP四层模型介绍"><a href="#一、TCP-IP四层模型介绍" class="headerlink" title="一、TCP&#x2F;IP四层模型介绍"></a>一、TCP&#x2F;IP四层模型介绍</h2><p>OSI的七层协议体系结构的概念清楚，理论也比较完整，但它既复杂又不实用，ISO制定的OSI参考模型的过于庞大、复杂招致了许多批评。由技术人员自己开发的TCP&#x2F;IP协议栈获得了更为广泛的应用。TCP&#x2F;IP体系结构则不同，它现在已经得到了非常广泛的应用，TCP&#x2F;IP是一个四层的体系结构。</p><p>它包含应用层、运输层、网际层和网络接口层（用网际层这个名字是强调这一层是为了解决不同网络的互连问题 ），不过从实质来讲，TCP&#x2F;IP只有最上面的三层，因为最下面的网络接口层基本上和一般的通信链路的功能上没有多大差别.</p><h2 id="二、TCP-IP四层模型"><a href="#二、TCP-IP四层模型" class="headerlink" title="二、TCP&#x2F;IP四层模型"></a>二、TCP&#x2F;IP四层模型</h2><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024106315.png" alt="tcp:ip四层.png"></p><p>每一层负责不同的功能:</p><p>链路层：有时也称作数据链路层或网络接口层，</p><p>通常包括操作系统中的设备驱动程序和计算机</p><p>中对应的网络接口卡。它们一起处理与电缆(或其他任何传输媒介)的物理接口细节。</p><p>网络层：有时也称作互联网层，处理分组在网络中的活动，例如分组的选路。在TCP&#x2F;IP协议族中，网络层协议包括IP协议(网际协议)，ICMP协议(Internet互联网控制报文协议 ，以及IGMP协议(Internet组管理协议 )。</p><p>运输层：主要为两台主机上的应用程序提供端到端的通信。在TCP&#x2F;IP 协议族中 ， 有两个互不相同的传输协议 : TCP (传输控制协议) 和UDP (用户数据报协议)。</p><p>TCP 为两台主机提供高可靠性的数据通信。它所做的工作包括把应用程序交给它的数据分 成合适的小块交给下面的网络层，确认接收到的分组，设置发送最后确认分组的超时时钟等。由于运输层提供了高可靠性的端到端的通信，因此应用层可以忽略所有这些细节。</p><p>而另一方面， UDP则为应用层提供一种非常简单的服务 。 它只是把称作数据报的分组从一台主机发送到另一台主机，但并不保证该数据报能到达另一端。任何必需的可靠 性必须由应用层来提供。 这两种运输层协议分别在不同的应用程序中有不同的用途，这一点将在后面看到。</p><p>应用层：负责处理特定的应用程序细节。几乎各种不同的 TCP&#x2F;IP实现都会提供下面这些通用的应用程序:</p><p>Telnet 远程登录。</p><p>FTP 文件传输协议。</p><p>SMTP 简单邮件传送协议。</p><p>SNMP 简单网络管理协议。</p><h3 id="TCP-IP协议簇"><a href="#TCP-IP协议簇" class="headerlink" title="TCP&#x2F;IP协议簇"></a>TCP&#x2F;IP协议簇</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024134979.png" alt="TCP:IP协议.png"></p><h3 id="一次C-S通信"><a href="#一次C-S通信" class="headerlink" title="一次C&#x2F;S通信"></a>一次C&#x2F;S通信</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024158331.png" alt="tcp:ip通信机制.png"></p><h1 id="传输层协议"><a href="#传输层协议" class="headerlink" title="传输层协议"></a>传输层协议</h1><p>TCP 和 UDP 是两种最为著名的传输层协议，二者都使用 I P 作 为 网 络 层 协 议</p><p>尽管 TCP 和 UDP 都使用相同的网络层( IP )， TCP 却向应用层提供与 UDP 完全不同的服务。 TCP 提供一种面向连接的、可靠的字节流服务。</p><p>TCP: 传输控制协议,面向连接的协议</p><p>面向连接意味着两个使用 TCP 的 应 用 ( 通 常 是 一 个 客 户 和 一 个 服 务 器 ) 在 彼 此 交 换 数 据 之前必须先建立一个 TCP 连 接 。</p><p>一对一传输</p><h3 id="一、三次握手"><a href="#一、三次握手" class="headerlink" title="一、三次握手"></a>一、三次握手</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024398414.jpeg" alt="TCP三次握手.jpeg"></p><h3 id="二、四次挥手"><a href="#二、四次挥手" class="headerlink" title="二、四次挥手"></a>二、四次挥手</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024418282.png" alt="tcp四次断开.png"></p><h3 id="三、TCP包头"><a href="#三、TCP包头" class="headerlink" title="三、TCP包头"></a>三、TCP包头</h3><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024479086.jpeg" alt="tcp包头.jpeg"></p><h3 id="四、UDP协议"><a href="#四、UDP协议" class="headerlink" title="四、UDP协议"></a>四、UDP协议</h3><p>UDP（User Datagram Protocol），用户数据报协议，是OSI(Open System Interconnection，开放式系统互联) 参考模型中一种无连接的传输层协议，提供面向事务的简单不可靠信息传送服务,UDP提供了无连接通信，适合于一次传输少量数据,UDP报文没有可靠性保证、顺序保证和流量控制字段等，可靠性较差。但是正因为UDP协议的控制选项较少，在数据传输过程中延迟小、数据传输效率高，适合对可靠性要求不高的应用程序，或者可以保障可靠性的应用程序，如DNS、TFTP、SNMP等。</p><p>可以一对一、一对多传输、多对一和多对多的交互通信</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/25/1601024457747.jpeg" alt="UDP包头.jpeg"></p><h3 id="五、TCP与UDP区别："><a href="#五、TCP与UDP区别：" class="headerlink" title="五、TCP与UDP区别："></a>五、TCP与UDP区别：</h3><p>1、TCP面向连接（如打电话要先拨号建立连接）;UDP是无连接的，即发送数据之前不需要建立连接</p><p>2、TCP提供可靠的服务。也就是说，通过TCP连接传送的数据，无差错，不丢失，不重复，且按序到达;UDP尽最大努力交付，即不保证可靠交付，Tcp通过校验和，重传控制，序号标识，滑动窗口、确认应答实现可靠传输。如丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制。</p><p>3、UDP具有较好的实时性，工作效率比TCP高，适用于对高速传输和实时性有较高的通信或广播通信。</p><p>4.每一条TCP连接只能是点到点的;UDP支持一对一，一对多，多对一和多对多的交互通信</p><p>5、TCP对系统资源要求较多，UDP对系统资源要求较少。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Web服务器—nginx与tomcat</title>
      <link href="/2023/04/26/Web%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2023/04/26/Web%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="1、Nginx介绍"><a href="#1、Nginx介绍" class="headerlink" title="1、Nginx介绍"></a>1、Nginx介绍</h2><p>Nginx(“engine x”)是一款是由俄罗斯的程序设计师Igor Sysoev所开发高性能的 Web和 反向代理服务器，也是一个 IMAP&#x2F;POP3&#x2F;SMTP 代理服务器。和apache一样，都是web服务器软件，因为其性能优异，所以被广大运维喜欢。又因为nginx是一个轻量级的web服务器，相比apache来说<strong>资源消耗更低</strong>。</p><p>延伸版本：<strong>tengine（淘宝）、openresrt（章亦春）等</strong></p><ul><li><a href="http://nginx.org/">http://nginx.org</a> 官网</li><li><a href="http://www.nginx.cn/doc/index.html">http://www.nginx.cn/doc/index.html</a> 中文文档</li></ul><p><strong>最近大事记：</strong></p><p>锤子科技在 T2 鸟巢发布会上将门票收入捐赠给了 OpenResty 开源项目<br>OpenResty(又称：ngx_openresty) 是一个基于 NGINX 的可伸缩的 Web 平台，由中国人章亦春发起，提供了很多高质量的第三方模块</p><h3 id="一、为什么选择Nginx"><a href="#一、为什么选择Nginx" class="headerlink" title="一、为什么选择Nginx"></a>一、为什么选择Nginx</h3><p>Nginx 是一个高性能的 Web 和反向代理服务器, 它具有有很多非常优越的特性:</p><p>作为 Web 服务器：相比 Apache，Nginx 使用更少的资源，支持更多的并发连接，体现更高的效率，这点使 Nginx 尤其受到虚拟主机提供商的欢迎。能够支持高达 50,000 个并发连接数的响应，感谢 Nginx 为我们选择了 epoll and kqueue 作为开发模型.</p><p>作为负载均衡服务器：Nginx 既可以在内部直接支持 Rails 和 PHP，也可以支持作为 HTTP代理服务器 对外进行服务。Nginx 用 C 编写, 不论是系统资源开销还是 CPU 使用效率都比 Perlbal 要好的多。</p><p>作为邮件代理服务器: Nginx 同时也是一个非常优秀的邮件代理服务器（最早开发这个产品的目的之一也是作为邮件代理服务器），Last.fm 描述了成功并且美妙的使用经验。</p><p>Nginx 安装非常的简单，配置文件 非常简洁（还能够支持perl语法），Bugs非常少的服务器: Nginx 启动特别容易，并且几乎可以做到7*24不间断运行，即使运行数个月也不需要重新启动。你还能够在 不间断服务的情况下进行软件版本的升级。</p><h3 id="二、Nginx和Apache对比"><a href="#二、Nginx和Apache对比" class="headerlink" title="二、Nginx和Apache对比"></a>二、Nginx和Apache对比</h3><ul><li>静态文件处理能力：nginx高于apache</li><li>资源消耗：nginx优于apache,因为nginx是异步处理模型，只需要几个进程就能够处理大量在线请求，而apache 2.4仍然是进程模型或者线程模型，即仍然采用大量线程来处理大量在线请求。</li><li>Apache支持的模块很多，而且也比较稳定。而nginx由于出现的比较晚，所以在这方面可能比不上Apache。</li><li>nginx本身就是一个反向代理服务器，而且支持7层负载均衡。</li><li>nginx处理动态页面很鸡肋，一般只用与处理静态页面和反向代理。</li></ul><h2 id="2、Nginx的安装部署"><a href="#2、Nginx的安装部署" class="headerlink" title="2、Nginx的安装部署"></a>2、Nginx的安装部署</h2><h3 id="一、nginx源码下载"><a href="#一、nginx源码下载" class="headerlink" title="一、nginx源码下载"></a>一、nginx源码下载</h3><p><strong>官网：</strong><a href="http://nginx.org/">http://nginx.org/</a></p><p><strong>源码包：</strong> nginx-1.19.3.tar.gz</p><p><strong>源码包下载：</strong> wget <a href="http://nginx.org/download/nginx-1.19.3.tar.gz">http://nginx.org/download/nginx-1.19.3.tar.gz</a> -P &#x2F;usr&#x2F;src</p><h3 id="二、nginx安装"><a href="#二、nginx安装" class="headerlink" title="二、nginx安装"></a>二、nginx安装</h3><pre><code>2.1、下载nginx源码包[root@zutuanxue ~]# wget http://nginx.org/download/nginx-1.19.3.tar.gz -P /usr/src[root@zutuanxue src]# cd /usr/src2.2、安装nginx依赖包[root@zutuanxue ~]# yum -y install gcc pcre-devel zlib-devel  - gcc: 源码编译工具   - pcre-devel： nginx url_rewrite 功能提供包   - zlib-devel： nginx 压缩功能提供包2.3、解压nginx源码，并进入源码包[root@zutuanxue src]# tar xf nginx-1.19.3.tar.gz[root@zutuanxue src]# cd nginx-1.19.32.4、配置nginx源码[root@zutuanxue nginx-1.19.3]# ./configure --prefix=/usr/local/nginx    配置目的：      1）检查环境 是否 满足安装条件     依赖解决      2）指定安装方式    配置文件   命令文件  各种文件放哪里   开启模块功能【内置模块  三方模块】      3）指定软件安装在那里2.5、编译nginx源码[root@zutuanxue nginx-1.19.3]# make -j42.6、安装nginx[root@zutuanxue nginx-1.19.3]# make install</code></pre><h3 id="三、nginx相关目录"><a href="#三、nginx相关目录" class="headerlink" title="三、nginx相关目录"></a>三、nginx相关目录</h3><p>nginx path prefix: “&#x2F;usr&#x2F;local&#x2F;nginx”</p><p>nginx binary file: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx”</p><p>nginx modules path: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;modules”</p><p>nginx configuration prefix: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf”</p><p>nginx configuration file: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf”</p><p>nginx pid file: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;nginx.pid”</p><p>nginx error log file: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;error.log”</p><p>nginx http access log file: “&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;logs&#x2F;access.log”</p><h3 id="四、nginx启动管理"><a href="#四、nginx启动管理" class="headerlink" title="四、nginx启动管理"></a>四、nginx启动管理</h3><p>配置文件测试：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -t</p><p>Nginx启动：&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx</p><p>Nginx关闭：killall –s QUIT nginx</p><h3 id="五、nginx启动测试"><a href="#五、nginx启动测试" class="headerlink" title="五、nginx启动测试"></a>五、nginx启动测试</h3><p>nginx安装完毕，接下来就可以启动nginx了，nginx启动后如何测试nginx的启动状态呢？可以通过以下三种方式去测试，这个可以根据自己的习惯选择一种测试就行了。</p><ul><li>使用netsata命令查看启动端口<br>[root@zutuanxue ~]# netstat –ntpl</li><li>使用losf命令查看启动端口<br>[root@zutuanxue ~]# lsof -i :80</li><li>使用文本浏览器访问nginx默认网站<br>[root@zutuanxue ~]# elinks <a href="http://ip/">http://IP</a></li></ul><p>测试页面内容如下</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105516493.png" alt="nginx默认网站页.png"></p><h2 id="3、Nginx的配置文件"><a href="#3、Nginx的配置文件" class="headerlink" title="3、Nginx的配置文件"></a>3、Nginx的配置文件</h2><h3 id="一、默认网站"><a href="#一、默认网站" class="headerlink" title="一、默认网站"></a>一、默认网站</h3><pre><code>server &#123;    listen       80;    server_name  localhost;    location / &#123;        root   html;        index  index.html index.htm;        #支持目录浏览         autoindex  on;    &#125;    error_page   500 502 503 504  /50x.html;    location = /50x.html &#123;        root   html;    &#125;&#125;</code></pre><h3 id="二、访问控制"><a href="#二、访问控制" class="headerlink" title="二、访问控制"></a>二、访问控制</h3><pre><code>location /a &#123;    autoindex on;    allow 192.168.12.0/24;    deny all;    #基于客户端IP做过滤，符合条件的允许访问，不符合的返回404；    if ( $remote_addr !~ &quot;192.168.12&quot; ) &#123;          #return 404;          return http://book.ayitula.com;             &#125;    &#125;</code></pre><h3 id="三、登陆验证"><a href="#三、登陆验证" class="headerlink" title="三、登陆验证"></a>三、登陆验证</h3><pre><code>location /c &#123;    auth_basic &quot;登陆验证&quot;;    auth_basic_user_file /etc/nginx/htpasswd;&#125;</code></pre><h3 id="四、日志管理"><a href="#四、日志管理" class="headerlink" title="四、日志管理"></a>四、日志管理</h3><p>Nginx访问日志主要有两个参数控制</p><p>log_format #用来定义记录日志的格式（可以定义多种日志格式，取不同名字即可）</p><p>access_log #用来指定日至文件的路径及使用的何种日志格式记录日志</p><p>access_log logs&#x2F;access.log main;</p><pre><code>log_format格式变量：    $remote_addr  #记录访问网站的客户端地址    $remote_user  #远程客户端用户名    $time_local  #记录访问时间与时区    $request  #用户的http请求起始行信息    $status  #http状态码，记录请求返回的状态码，例如：200、301、404等    $body_bytes_sent  #服务器发送给客户端的响应body字节数    $http_referer  #记录此次请求是从哪个连接访问过来的，可以根据该参数进行防盗链设置。    $http_user_agent  #记录客户端访问信息，例如：浏览器、手机客户端等    $http_x_forwarded_for  #当前端有代理服务器时，设置web节点记录客户端地址的配置，此参数生效的前提是代理服务器也要进行相关的x_forwarded_for设置</code></pre><p>自定义一个json格式的访问日志</p><pre><code>log_format main_json &#39;&#123;&quot;@timestamp&quot;:&quot;$time_local&quot;,&#39;&#39;&quot;client_ip&quot;: &quot;$remote_addr&quot;,&#39;&#39;&quot;request&quot;: &quot;$request&quot;,&#39;&#39;&quot;status&quot;: &quot;$status&quot;,&#39;&#39;&quot;bytes&quot;: &quot;$body_bytes_sent&quot;,&#39;&#39;&quot;x_forwarded&quot;: &quot;$http_x_forwarded_for&quot;,&#39;&#39;&quot;referer&quot;: &quot;$http_referer&quot;&#39;&#39;&#125;&#39;;access_log logs/access_json.log main_json;</code></pre><h3 id="五、日志截断"><a href="#五、日志截断" class="headerlink" title="五、日志截断"></a>五、<strong>日志截断</strong></h3><pre><code>mv access.log access.log.0killall -USR1 \`cat master.nginx.pid\`sleep 1gzip access.log.0</code></pre><h3 id="六、防盗链"><a href="#六、防盗链" class="headerlink" title="六、防盗链"></a>六、防盗链</h3><pre><code>location /images/ &#123;alias /data/images/;valid_referers none blocked *.ayitula.com;    if ($invalid_referer) &#123;    rewrite ^/      http://www.ayitula.com/daolian.gif;    #return 403;    &#125;&#125;</code></pre><h2 id="4、反向代理"><a href="#4、反向代理" class="headerlink" title="4、反向代理"></a>4、反向代理</h2><h3 id="一、代理介绍"><a href="#一、代理介绍" class="headerlink" title="一、代理介绍"></a>一、代理介绍</h3><p>代理在网络中使用是比较常见的，比如我们说的最多的就是翻墙软件，比如ss、蓝灯等这些大家常用的软件，他们就是能改代理大家访问国内无法访问的一些国外网站，比如facebook、YouTube等网站。其原理也比较简单：</p><p>1）用户将请求发给代理服务器</p><p>2）代理服务器代用户去访问数据</p><p>3）代理服务器将数据给用户</p><p><strong>正常没有代理情况上网</strong></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105139047.png" alt="反代1.png"></p><p><strong>代理服务器场景</strong></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105146133.png" alt="反代2.png"></p><p><strong>代理服务器扮演的就是一个中间人的角色。</strong></p><p>代理分为正向代理和反向代理两种类型：</p><p>正向代理：代理用户访问其他网站，比如ss，蓝灯。</p><p>反向代理：用来发布服务器，比如nginx</p><p>树明主要给大家介绍的是反向代理，使用反向代理发布公司的站点。**(国家严厉打击私单乱建翻墙代理服务器)**</p><h3 id="二、应用场景"><a href="#二、应用场景" class="headerlink" title="二、应用场景"></a>二、应用场景</h3><p>1）堡垒机：堡垒机承担所有的外部访问，保护后端服务器的安全</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105157770.png" alt="反代堡垒机.png"></p><p>2）业务发布服务器：将多个服务器通过虚拟主机的方式发布到公网</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105225160.png" alt="反代发布服务器.png"></p><p>3）缓存服务器：CDN加速<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105185130.png" alt="反代缓存服务器.png"></p><h3 id="三、反向代理原理"><a href="#三、反向代理原理" class="headerlink" title="三、反向代理原理"></a>三、反向代理原理</h3><p>\1) 客户端通过浏览器 发起请求   代理服务器</p><p>2）代理服务器   接受请求</p><p>\3) 代理服务器   发起请求   业务服务器</p><p>4）业务服务器  接受请求</p><p>5）业务服务器  处理请求</p><p>\6) 业务服务器  响应请求   代理服务器</p><p>7）代理服务器  响应请求  客户端</p><p>8）客户端通过浏览器渲染请求并展示给用户</p><h3 id="四、反向代理实现"><a href="#四、反向代理实现" class="headerlink" title="四、反向代理实现"></a>四、反向代理实现</h3><p><strong>proxy_pass: nginx反向代理指令</strong></p><p><strong>反向代理实现</strong></p><p>location &#x2F; {</p><p>index index.php index.html index.htm; #定义首页索引文件的名称</p><p>proxy_pass <a href="http://mysvr/">http://mysvr</a> ;#请求转向mysvr 定义的服务器列表</p><p>}</p><p><strong>反向代理优化</strong></p><pre><code>proxy_set_header Host $host;   #修改请求头，添加Host字段proxy_set_header X-Real-IP $remote_addr;   #修改请求头，添加X-Real-IP字段proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;   #修改请求头，添加X-Forwarded-For字段client_max_body_size 10m;    #允许客户端请求的最大单文件字节数client_body_buffer_size 128k;  #缓冲区代理缓冲用户端请求的最大字节数，proxy_connect_timeout 90;  #nginx跟后端服务器连接超时时间\(代理连接超时\)proxy_send_timeout 90;        #后端服务器数据回传时间\(代理发送超时\)proxy_read_timeout 90;         #连接成功后，后端服务器响应时间\(代理接收超时\)proxy_buffer_size 4k;             #设置代理服务器（nginx）保存用户头信息的缓冲区大小proxy_buffers 4 32k;               #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置proxy_busy_buffers_size 64k;    #高负荷下缓冲大小（proxy_buffers*2）proxy_temp_file_write_size 64k;  #设定缓存文件夹大小，大于这个值，将从upstream服务器传</code></pre><h2 id="5、Nginx的优化"><a href="#5、Nginx的优化" class="headerlink" title="5、Nginx的优化"></a>5、Nginx的优化</h2><h3 id="一、调优的必要性"><a href="#一、调优的必要性" class="headerlink" title="一、调优的必要性"></a>一、调优的必要性</h3><p>在聊调优之前，我们先要知道为何调优，业务运行和调优的关系。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/12/6/1607251234038.png" alt="42967083431970b0eb40b3949278a0d1.png"></p><p>业务运行：线上业务正常运行，承载了公司业务。<br>监控业务：通过监控业务对线上业务进行监控，及时发现问题。<br>优化业务：通过监控分析，发现业务问题或者瓶颈，及时对业务或者软件就行调整、优化。<br>测试优化：优化完成后，需要对现有的优化进行测试，保证业务在当前优化模式中稳定、高效，能够解决当前问题。<br>这就是业务运行的一个流程，也是我们保证业务稳定、高效、高可用的运维之道。</p><h3 id="二、调优的维度和见解分歧"><a href="#二、调优的维度和见解分歧" class="headerlink" title="二、调优的维度和见解分歧"></a>二、调优的维度和见解分歧</h3><p> 调优类的文章是最难写的，因为我只能告诉你调优的选项，无法告诉你具体的阈值，因为不同的业务运行在不同的机器，所消耗的资源是不同的；又因为场景不同，对应的调优项及阈值是千变万化的，就好比你和你上铺的兄弟都是感冒了，去医院看病开的药却是截然不同的。正是如此，才会出现当很多人看到调优的文章，看到了具体的调优项或者阈值就会浮现出两个字，我不好意思说，配个图吧！大家意会就好。</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/12/6/1607251822347.png" alt="28a4aaa7cf00a2483492b17857a75176.png"></p><h3 id="Nginx跳跃"><a href="#Nginx跳跃" class="headerlink" title="Nginx跳跃"></a>Nginx跳跃</h3><h4 id="1、并发优化"><a href="#1、并发优化" class="headerlink" title="1、并发优化"></a>1、并发优化</h4><p>nginx工作模式：主进程+工作进程</p><pre><code>启动工作进程数量worker_processes  4;#指定运行的核的编号，采用掩码的方式设置编号worker_cpu_affinity   0001 0010 0100 1000;events &#123;单个工作进程维护的请求队列长度    worker_connections  1024;&#125;</code></pre><h4 id="2、长连接"><a href="#2、长连接" class="headerlink" title="2、长连接"></a>2、长连接</h4><p>减少服务器维护因为与客户端建立http连接产生的大量tcp三次握手四次断开的开销</p><pre><code>keepalive_timeout  0;  0代表关闭#keepalive_timeout  100;#keepalive_requests 8192;</code></pre><h4 id="3、压缩"><a href="#3、压缩" class="headerlink" title="3、压缩"></a>3、压缩</h4><p>降低传输时间，增加用户体验度；降低公司带宽费用。</p><pre><code>gzip  on;gzip_proxied any;gzip_min_length 1k;gzip_buffers 4 8k;gzip_comp_level 6;gzip_types text/plain text/css application/x-javascript application/javascript application/xml;    # 开启gzip    gzip off;    #Nginx做为反向代理的时候启用：    off – 关闭所有的代理结果数据压缩    expired – 如果header中包含”Expires”头信息，启用压缩    no-cache – 如果header中包含”Cache-Control:no-cache”头信息，启用压缩    no-store – 如果header中包含”Cache-Control:no-store”头信息，启用压缩    private – 如果header中包含”Cache-Control:private”头信息，启用压缩    no_last_modified – 启用压缩，如果header中包含”Last_Modified”头信息，启用压缩    no_etag – 启用压缩，如果header中包含“ETag”头信息，启用压缩    auth – 启用压缩，如果header中包含“Authorization”头信息，启用压缩    any – 无条件压缩所有结果数据    gzip_proxied any;    # 启用gzip压缩的最小文件，小于设置值的文件将不会压缩    gzip_min_length 1k;    # gzip 压缩级别，1-9，数字越大压缩的越好，也越占用CPU时间，后面会有详细说明    gzip_comp_level 1;    # 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;    # 增加响应头”Vary: Accept-Encoding”    # 是否在http header中添加Vary: Accept-Encoding，建议开启    gzip_vary on;    # 禁用IE 6 gzip    gzip_disable &quot;MSIE [1-6]\.&quot;;    # 设置压缩所需要的缓冲区大小         gzip_buffers 32 4k;    # 设置gzip压缩针对的HTTP协议版本    gzip_http_version 1.0;</code></pre><h4 id="4、静态缓存"><a href="#4、静态缓存" class="headerlink" title="4、静态缓存"></a>4、静态缓存</h4><p>将部分数据缓存在用户本地磁盘，用户加载时，如果本地和服务器的数据一致，则从本地加载。提升用户访问速度，提升体验度。节省公司带宽成本。</p><pre><code>expires指令：开启缓存并指定静态缓存时间location ~*  \.(png|gif)$ &#123;              expires 1h;         &#125;</code></pre><h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h2 id="1、Tomcat的安装部署"><a href="#1、Tomcat的安装部署" class="headerlink" title="1、Tomcat的安装部署"></a>1、Tomcat的安装部署</h2><h3 id="一、下载软件包"><a href="#一、下载软件包" class="headerlink" title="一、下载软件包"></a>一、下载软件包</h3><p>tomcat：<a href="https://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-9/v9.0.31/bin/apache-tomcat-9.0.31.zip">https://mirrors.tuna.tsinghua.edu.cn/apache/tomcat/tomcat-9/v9.0.31/bin/apache-tomcat-9.0.31.zip</a></p><p>jdk：<a href="https://www.oracle.com/java/technologies/javase-downloads.html">https://www.oracle.com/java/technologies/javase-downloads.html</a></p><p>如何想使用tomcat9的话，官方要求JRE的版本必须是8以上的，所以在安装之前，我们需要确认一下本机的版本,如果满足需求的话可以直接安装tomcat</p><h3 id="二、安装JDK"><a href="#二、安装JDK" class="headerlink" title="二、安装JDK"></a>二、安装JDK</h3><pre><code># 1、查看当前是否安装过jdk[root@zutuanxue ~]# java -versionbash: java: 未找到命令...文件搜索失败: Cannot update read-only repo#系统提示没有找到命令，意味着没有安装相关软件包，所以我们要安装# 2、安装jdk[root@zutuanxue ~]# rpm -ivh jdk-13.0.2_linux-x64_bin.rpm 警告：jdk-13.0.2_linux-x64_bin.rpm: 头V3 RSA/SHA256 Signature, 密钥 ID ec551f03: NOKEYVerifying...                          ################################# [100%]准备中...                          ################################# [100%]正在升级/安装...   1:jdk-13.0.2-2000:13.0.2-ga        ################################# [100%]# 3、验证：安装完成后再次查看[root@zutuanxue ~]# java -versionjava version &quot;13.0.2&quot; 2020-01-14Java(TM) SE Runtime Environment (build 13.0.2+8)#java的运行环境，也叫jreJava HotSpot(TM) 64-Bit Server VM (build 13.0.2+8, mixed mode, sharing) #JVM java的虚拟机，可以使Java语言在不同平台上运行时不需要重新编译。Java语言使用Java虚拟机屏蔽了与具体平台相关的信息，使得Java语言编译程序只需生成在Java虚拟机上运行的字节码就可以了，这样就可以在多种平台上不加修改地运行。很多语言都采用了这种类似的思路，才使得他们具有可移植性，比如说python</code></pre><h3 id="三、安装Tomcat"><a href="#三、安装Tomcat" class="headerlink" title="三、安装Tomcat"></a>三、安装Tomcat</h3><pre><code># 1、tomcat 安装我们可以看到tomcat软件包的名称包含有apache字样，原因很简单，它是由apache资助的项目[root@zutuanxue ~]# unzip apache-tomcat-9.0.31.zip -d /opt/[root@zutuanxue ~]# cd /opt/[root@zutuanxue opt]# mv apache-tomcat-9.0.31 tomcat1解压完成，改个名就可以使用了，因为tomcat是一个二进制包，什么意思呢？就类似于我们下载游戏的时候的硬盘版，什么是硬盘版？解压就能玩，所以这个tomcat我们就压之后就可以使用了，不需要安装。[root@zutuanxue bin]# sh startup.sh Cannot find ./catalina.shThe file is absent or does not have execute permissionThis file is needed to run this program# 2、启动tomcat  ## tomcat启动命令目录[root@zutuanxue bin]# pwd/opt/tomcat1/bin  ## 启动tomcat[root@zutuanxue bin]# chmod +x catalina.sh [root@zutuanxue bin]# sh startup.sh Using CATALINA_BASE:   /opt/tomcat1Using CATALINA_HOME:   /opt/tomcat1Using CATALINA_TMPDIR: /opt/tomcat1/tempUsing JRE_HOME:        /usrUsing CLASSPATH:       /opt/tomcat1/bin/bootstrap.jar:/opt/tomcat1/bin/tomcat-juli.jarTomcat started.[root@zutuanxue webapps]# netstat -antp | grep javatcp6       0      0 127.0.0.1:8005          :::*                    LISTEN      46987/java          tcp6       0      0 :::8080                 :::*                    LISTEN      46987/java    tomcat的两个端口8005 是关闭tomcat使用的端口，可以使用telnet serverip 8005 然后输入大写的SHUTDOWN关闭tomcat，所以建议更改端口 或者把引号中了命令改成不容易记忆的，个人推荐改命令，因为改端口没有告诉负责网络安全的同事就会给你屏蔽掉………8080 连接端口8009 AJP协议使用的端口，tomcat的优势是处理jsp页面 但是对于图片，静态页面处理能力特别差，相对于apache来说，那么这个时候怎么办 做个分流 jsp页面由tomcat完成，静态的页面 图片由AJP来完成，AJP是定向包协议 使用二进制格式来传输可读性文本，在server.xml配置文件中默认不生效</code></pre><p><strong>访问默认首页</strong> <a href="http://localhost:8080/">http://localhost:8080</a><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/19/1603105819709.png" alt="tomcat默认页.png"></p><p>注意: tomcat的访问端口是8080</p><pre><code>提示：如果之前系统中安装过java环境的话，可能会出现即便安装完成新的jdk之后，使用java -version命令所查询的结果依然是老版本的，这个问题是由于环境变量引起的，所以需要修改环境变量设置文件[root@zutuanxue ~]# vim /root/.bash_profile #####javaJAVA_HOME=/usr/java/jdk-13.0.2#对应自己安装的版本PATH=$JAVA_HOME/bin:$PATH:$HOME/binCLASSPATH=.:$JAVA_HOME/lib/tools.jar:$JAVA_HOME/lib/dt.jarexport PATH JAVA_HOME CLASSPATH CATALINA_HOME</code></pre><h2 id="2、-目录与配置文件"><a href="#2、-目录与配置文件" class="headerlink" title="2、 目录与配置文件"></a>2、 目录与配置文件</h2><h3 id="一、Tomcat目录说明"><a href="#一、Tomcat目录说明" class="headerlink" title="一、Tomcat目录说明"></a>一、Tomcat目录说明</h3><p><strong>tomcat主目录</strong></p><pre><code>bin：命令，存放不同平台上启动或关闭的脚本BUILDING.txt&amp;RUNNING.txt：使用文档，告诉用户如何搭建conf：各种全局配置文件，最主要的是server.xml和web.xmlCONTRIBUTING.md：捐赠lib：tomcat需要用到的库，主要是各种jar包LICENSE：许可logs：存放tomcat的日志NOTICE：通知信息README.md：读我文档RELEASE-NOTES：版本信息temp：临时文件  webapps：tomcat的web发布目录，类似于nginx或者apache的html目录  work：tomcat的工作目录，存放的是jsp编译后产生的.class文件及.java文件。清空work目录，然后重启tomcat，可以达到清除缓存的作用。</code></pre><p><strong>bin目录</strong></p><pre><code>bin目录下的文件主要有两类，一个是Linux使用的.sh结尾的文件，另外一个是windows使用的.bat结尾的文件，catalinatomcat的设置脚本，也可以启动&amp;关闭tomcat[root@zutuanxue bin]# sh catalina.sh helpUsing CATALINA_BASE:   /opt/tomcat1Using CATALINA_HOME:   /opt/tomcat1Using CATALINA_TMPDIR: /opt/tomcat1/tempUsing JRE_HOME:        /usrUsing CLASSPATH:       /opt/tomcat1/bin/bootstrap.jar:/opt/tomcat1/bin/tomcat-juli.jarUsage: catalina.sh ( commands ... )commands:  debug             Start Catalina in a debugger  debug -security   Debug Catalina with a security manager  jpda start        Start Catalina under JPDA debugger  run               Start Catalina in the current window  run -security     Start in the current window with security manager  start             Start Catalina in a separate window  start -security   Start in a separate window with security manager  stop              Stop Catalina, waiting up to 5 seconds for the process to end  stop n            Stop Catalina, waiting up to n seconds for the process to end  stop -force       Stop Catalina, wait up to 5 seconds and then use kill -KILL if still running  stop n -force     Stop Catalina, wait up to n seconds and then use kill -KILL if still running  configtest        Run a basic syntax check on server.xml - check exit code for result  version           What version of tomcat are you running?Note: Waiting for the process to end and use of the -force option require that $CATALINA_PID is defined[root@zutuanxue bin]# sh catalina.sh stop[root@zutuanxue bin]# sh catalina.sh helpstartup启动脚本shutdown关闭脚本</code></pre><p><strong>conf目录</strong></p><pre><code>这个目录下主要存放的是与tomcat设置相关的文件，常用的配置文件主要包含server.xml可以设置端口号、设置域名或IP、默认加载的项目、请求编码 web.xml可以设置tomcat支持的文件类型 context.xml可以用来配置数据源之类的 tomcat-users.xml用来配置管理tomcat的用户与权限 Catalina此目录下可以设置默认加载的项目 </code></pre><p><strong>webapps目录</strong></p><pre><code>ROOTtomcat默认的页面docs使用说明文档examples例子--tomcat首页中的examples按钮对应的内容host-manager首页Host Manager按钮对应的内容manager  首页 Manager App按钮对应的内容</code></pre><h3 id="二、Tomcat相关配置文件简介"><a href="#二、Tomcat相关配置文件简介" class="headerlink" title="二、Tomcat相关配置文件简介"></a>二、Tomcat相关配置文件简介</h3><p><strong>server.xml</strong></p><table><thead><tr><th>元素名</th><th>属性</th><th>解释</th></tr></thead><tbody><tr><td>server</td><td>port</td><td>指定一个端口，这个端口负责监听关闭tomcat的请求</td></tr><tr><td></td><td>shutdown</td><td>指定向端口发送的命令字符串</td></tr><tr><td>service</td><td>name</td><td>指定service的名字</td></tr><tr><td>Connector(表示客户端和service之间的连接)</td><td>port</td><td>指定服务器端要创建的端口号，并在这个断口监听来自客户端的请求</td></tr><tr><td></td><td>minProcessors</td><td>服务器启动时创建的处理请求的线程数</td></tr><tr><td></td><td>maxProcessors</td><td>最大可以创建的处理请求的线程数</td></tr><tr><td></td><td>enableLookups</td><td>如果为true，则可以通过调用request.getRemoteHost()进行DNS查询来得到远程客户端的实际主机名，若为false则不进行DNS查询，而是返回其ip地址</td></tr><tr><td></td><td>redirectPort</td><td>指定服务器正在处理http请求时收到了一个SSL传输请求后重定向的端口号</td></tr><tr><td></td><td>acceptCount</td><td>指定当所有可以使用的处理请求的线程数都被使用时，可以放到处理队列中的请求数，超过这个数的请求将不予处理</td></tr><tr><td></td><td>connectionTimeout</td><td>指定超时的时间数(以毫秒为单位)</td></tr><tr><td>Engine(表示指定service中的请求处理引擎，接收和处理来自Connector的请求)</td><td>defaultHost</td><td>指定缺省的处理请求的主机名，它至少与其中的一个host元素的name属性值是一样的</td></tr><tr><td>Context(表示一个web应用程序，通常为WAR文件，关于WAR的具体信息见servlet规范)</td><td>docBase</td><td>应用程序的路径或者是WAR文件存放的路径</td></tr><tr><td></td><td>path</td><td>表示此web应用程序的url的前缀，这样请求的url为<a href="http://localhost:8080/path/">http://localhost:8080/path/</a></td></tr><tr><td></td><td>reloadable</td><td>这个属性非常重要，如果为true，则tomcat会自动检测应用程序的&#x2F;WEB-INF&#x2F;lib 和&#x2F;WEB-INF&#x2F;classes目录的变化，自动装载新的应用程序，我们可以在不重起tomcat的情况下改变应用程序</td></tr><tr><td>host(表示一个虚拟主机)</td><td>name</td><td>指定主机名</td></tr><tr><td></td><td>appBase</td><td>应用程序基本目录，即存放应用程序的目录</td></tr><tr><td></td><td>unpackWARs</td><td>如果为true，则tomcat会自动将WAR文件解压，否则不解压，直接从WAR文件中运行应用程序</td></tr><tr><td>Logger(表示日志，调试和错误信息)</td><td>className</td><td>指定logger使用的类名，此类必须实现org.apache.catalina.Logger 接口</td></tr><tr><td></td><td>prefix</td><td>指定log文件的前缀</td></tr><tr><td></td><td>suffix</td><td>指定log文件的后缀</td></tr><tr><td></td><td>timestamp</td><td>如果为true，则log文件名中要加入时间，如下例:localhost_log.004-mm-dd.txt</td></tr><tr><td>Realm(表示存放用户名，密码及role的数据库)</td><td>className</td><td>指定Realm使用的类名，此类必须实现org.apache.catalina.Realm接口</td></tr><tr><td>Valve(功能与Logger差不多，其prefix和suffix属性解释和Logger 中的一样)</td><td>className</td><td>指定Valve使用的类名，如用org.apache.catalina.valves.AccessLogValve类可以记录应用程序的访问信息</td></tr><tr><td></td><td>directory</td><td>指定log文件存放的位置</td></tr><tr><td></td><td>pattern</td><td>有两个值，common方式记录远程主机名或ip地址，用户名，日期，第一行请求的字符串，HTTP响应代码，发送的字节数。combined方式比common方式记录的值更多</td></tr></tbody></table><p><strong>web.xml</strong></p><p>默认Web应用的首页文件的设置</p><p>报错文件的设置</p><p>session 会话过期时间的设置,单位是分钟</p><p>servlet的设置(Java Servlet的简称，称为小服务程序或服务连接器，用Java编写的服务器端程序，具有独立于平台和协议的特性，主要功能在于交互式地浏览和生成数据，生成动态Web内容。)</p><p><strong>tomcat-users.xml</strong></p><p>管理用户配置文件</p><p>rolename 定义角色，不同的角色管理权限不同，相当于组</p><pre><code>manager-gui允许访问html接口(即URL路径为/manager/html/*)manager-script允许访问纯文本接口(即URL路径为/manager/text/*)manager-jmx允许访问JMX代理接口(即URL路径为/manager/jmxproxy/*)manager-status允许访问Tomcat只读状态页面(即URL路径为/manager/status/*)admin-gui 允许访问html管理界面admin-script 允许访问文本管理界面</code></pre><p>user 定义用户名</p><pre><code>username定义用户名password设置密码roles属于那些角色/组</code></pre><h2 id="3、Tomcat发布页面"><a href="#3、Tomcat发布页面" class="headerlink" title="3、Tomcat发布页面"></a>3、Tomcat发布页面</h2><h3 id="一、静态页面"><a href="#一、静态页面" class="headerlink" title="一、静态页面"></a>一、静态页面</h3><h4 id="①访问tomcat网站管理页面"><a href="#①访问tomcat网站管理页面" class="headerlink" title="①访问tomcat网站管理页面"></a>①访问tomcat网站管理页面</h4><p>打开浏览器，在地址栏中输入 <a href="http://localhost:8080/">http://localhost:8080</a><br>看到如下页面，该页面是tomcat的默认网站，同时还提供了以下功能</p><ul><li>server status 查看服务器的状态，包括linux主机的信息，tomcat的版本信息，资源使用情况等</li><li>manager app 管理网站</li><li>host manager 虚拟主机的管理</li></ul><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160256413.png" alt="image20200312154145218.png"></p><p>默认使用这三个功能需要提供账号密码，如果没有可以采用以下的方式去修改配置文件，设置用以访问的账号密码。</p><p>在提示登录的界面点击取消，会看到提示</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160330788.png" alt="image20200312154227858.png"></p><pre><code>[root@zutuanxue ~]# vim /opt/tomcat1/conf/tomcat-users.xml &lt;role rolename=&quot;manager-gui&quot;/&gt;  &lt;role rolename=&quot;manager-script&quot;/&gt;  &lt;role rolename=&quot;manager-jmx&quot;/&gt;  &lt;role rolename=&quot;manager-status&quot;/&gt;  &lt;role rolename=&quot;admin-gui&quot;/&gt;  &lt;role rolename=&quot;admin-script&quot;/&gt;  &lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script&quot;/&gt;</code></pre><p>设置完成之后重启tomcat就可以登录后台管理页面了，其中在manager app中主要管理的是网站是否发布的操作，start&#x3D;发布网站</p><p>stop&#x3D;停止发布网站，reload&#x3D;重新加载，undeploy&#x3D;卸载&#x2F;删除网站（慎用），expire session&#x3D;会话过期时间</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160530000.png" alt="image20200312160956755.png"></p><p>与war文件部署相关的设置，包括定义war文件存放的位置，和上传war文件</p><pre><code>war是一个可以直接运行的web模块，通常用于网站，打包部署。以Tomcat来说，将war包放置在其\webapps\目录下，然后启动Tomcat，这个包就会自动解压，就相当于发布了。war包是Sun提出的一种web应用程序格式，与jar类似，是很多文件的压缩包。war包中的文件按照一定目录结构来组织。简单来说，war包是JavaWeb程序打的包，war包里面包括写的代码编译成的class文件，依赖的包，配置文件，所有的网站页面，包括html，jsp等等。一个war包可以理解为是一个web项目，里面是项目的所有东西。</code></pre><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160554207.png" alt="image20200312161045722.png"></p><p>configuration 定义TLS(安全传输协议)配置文件</p><p>diagnostics 检查网站在启动，重新加载或卸载时，是否造成内存溢出，这个操作会触发垃圾回收机制，生产环境中慎用</p><p>TLS connector configuration diagnostics 加密诊断，可以帮助用户诊断加密是否有问题</p><h4 id="②firefox设置中文"><a href="#②firefox设置中文" class="headerlink" title="②firefox设置中文"></a>②firefox设置中文</h4><pre><code>[root@zutuanxue ~]# dnf install ibus* -y</code></pre><p>添加完整的中文环境后重启</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160597852.png" alt="image20200313163452841.png"></p><p>重启完成为浏览器添加中文后重启浏览器</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160616038.png" alt="image20200313163127816.png"></p><p>再次访问tomcat管理界面就会变成中文</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160631864.png" alt="image20200313163617973.png"></p><h4 id="③发布静态页面"><a href="#③发布静态页面" class="headerlink" title="③发布静态页面"></a>③<strong>发布静态页面</strong></h4><pre><code>[root@zutuanxue webapps]# pwd/opt/tomcat1/webapps[root@zutuanxue webapps]# mkdir test[root@zutuanxue webapps]# echo &#39;&lt;%= new java.util.Date() %&gt;&#39;  &gt; test/index.jsp</code></pre><p>使用浏览器访问<a href="http://ip:8080/test,%E6%AF%8F%E6%AC%A1%E5%88%B7%E6%96%B0%E6%97%B6%E9%97%B4%E9%83%BD%E4%BC%9A%E6%94%B9%E5%8F%98">http://ip:8080/test,每次刷新时间都会改变</a></p><h3 id="二、动态页面"><a href="#二、动态页面" class="headerlink" title="二、动态页面"></a>二、动态页面</h3><p>我们知道tomcat是用来发布jsp网站的，jsp的网站，页面漂亮还安全，上节课我们已经知道如何发布静态页面了，本节课我们一起来看一下如何发布动态页面，我们通过jpress一个使用java开发的建站软件来实现jsp页面</p><pre><code>jpress下载地址：http://jpress.io/download</code></pre><p><strong>step 1</strong> 准备jsp页面</p><pre><code>[root@zutuanxue ~]# mv jpress-v3.2.1.war jpress.war[root@zutuanxue ~]# cp jpress.war /opt/tomcat1/webapps/#重启tomcat[root@zutuanxue ~]# cp jpress.war /opt/tomcat1/webapps/[root@zutuanxue ~]# sh /opt/tomcat1/bin/shutdown.sh [root@zutuanxue ~]# sh /opt/tomcat1/bin/startup.sh #重启之后tomcat会自己将这个war的压缩包解压，生成一个同名的目录</code></pre><p><strong>step 2</strong> 准备数据库</p><pre><code>[root@zutuanxue yum.repos.d]# dnf install mariadb mariadb-server -y[root@zutuanxue yum.repos.d]# systemctl restart mariadb.service [root@zutuanxue ~]# mysql -u root -pEnter password: MariaDB [(none)]&gt; create database jpress charset utf8;MariaDB [(none)]&gt; grant all on jpress.* to jpress@&#39;localhost&#39; identified by &#39;123456&#39;;</code></pre><p><strong>step 3</strong> 安装jpress</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160976235.png" alt="image20200313141545372.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603160997472.png" alt="image20200313141616340.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603161027211.png" alt="image20200313141647962.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603161051771.png" alt="image20200313141659536.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603161069805.png" alt="image20200313141725515.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603161088428.png" alt="image20200313141752995.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603161108200.png" alt="image20200313141822315.png"></p><h2 id="4、多实例"><a href="#4、多实例" class="headerlink" title="4、多实例"></a>4、多实例</h2><p>Tomcat是一个单进程多线程的软件，在很早之前，我们都认为这种模式挺好的，因为早些年的CPU都是单核的，但是现在都是多核心的CPU了,如果还是一个进程的话呢，就比较浪费CPU资源，所以本节课我们要讨论下如果多开几个tomcat，也就是我们本节课要实现的是tomcat的多实例，这样可以提高资源的利用率，在之前的课程中我们提到过tomcat有三个端口8005 8009 8080，其中8005是用来关闭tomcat的端口，8080是访问端口，8009是ajp协议使用的端口，如果我想在一台机器上开启多个tomcat的话，首先要保证的就是端口不能冲突，否则开不了。</p><h3 id="Tomcat多实例实现"><a href="#Tomcat多实例实现" class="headerlink" title="Tomcat多实例实现"></a>Tomcat多实例实现</h3><ul><li>将之前部署好的tomcat复制一份</li></ul><pre><code>[root@zutuanxue webapps]# cd /opt/[root@zutuanxue opt]# lstomcat1[root@zutuanxue opt]# cp -r tomcat1 tomcat2[root@zutuanxue opt]# lstomcat1  tomcat2</code></pre><ul><li>修改刚刚部署完成的tomcat的相关配置文件</li></ul><pre><code>[root@zutuanxue opt]# vim tomcat2/conf/server.xml &lt;Server port=&quot;8006&quot; shutdown=&quot;SHUTDOWN&quot;&gt;&lt;Connector port=&quot;8081&quot; protocol=&quot;HTTP/1.1&quot;               connectionTimeout=&quot;20000&quot;               redirectPort=&quot;8444&quot; /&gt;#修改端口</code></pre><ul><li>启动tomcat</li></ul><pre><code>[root@zutuanxue opt]# sh /opt/tomcat1/bin/startup.sh [root@zutuanxue opt]# sh /opt/tomcat2/bin/startup.sh [root@zutuanxue opt]# netstat -atnpActive Internet connections (servers and established)Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    tcp6       0      0 127.0.0.1:8005          :::*                    LISTEN      16801/java          tcp6       0      0 127.0.0.1:8006          :::*                    tcp6       0      0 :::8080                 :::*                    LISTEN      16801/java          tcp6       0      0 :::8081                 :::*                    LISTEN      17776/java          </code></pre><ul><li>打开浏览器访问测试</li></ul><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603162375841.png" alt="image20200313144207263.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603162404686.png" alt="image20200313144222035.png"></p><pre><code>注意：如果是不同用户使用的话，考虑到安全方面的问题，记得修改tomcat的用户管理文件。[root@zutuanxue conf]# pwd/opt/tomcat2/conf[root@zutuanxue conf]# vim tomcat-users.xml &lt;role rolename=&quot;manager-gui&quot;/&gt;  &lt;role rolename=&quot;manager-script&quot;/&gt;  &lt;role rolename=&quot;manager-jmx&quot;/&gt;  &lt;role rolename=&quot;manager-status&quot;/&gt;  &lt;role rolename=&quot;admin-gui&quot;/&gt;  &lt;role rolename=&quot;admin-script&quot;/&gt;  &lt;user username=&quot;tomcat&quot; password=&quot;tomcat&quot; roles=&quot;manager-gui,manager-script,manager-jmx,manager-status,admin-gui,admin-script&quot;/&gt;</code></pre><h2 id="5、使用nginx发布tomcat站点"><a href="#5、使用nginx发布tomcat站点" class="headerlink" title="5、使用nginx发布tomcat站点"></a>5、使用nginx发布tomcat站点</h2><p>之前我们在访问的时候使用的都是类似<a href="http://serverip/test%E6%88%96%E8%80%85http://serverip/jpress%E8%BF%99%E7%A7%8D%E5%AD%97%E6%A0%B7%E7%9A%84URL%EF%BC%8C%E4%BD%BF%E7%94%A8%E8%B5%B7%E6%9D%A5%E6%AF%94%E8%BE%83%E9%BA%BB%E7%83%A6%EF%BC%8C%E6%89%80%E4%BB%A5%E5%91%A2%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%B0%86tomcat%E5%92%8Cnginx%E7%BB%93%E5%90%88%E5%9C%A8%E4%B8%80%E8%B5%B7%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87nginx%E4%BB%A5%E4%B8%8B%E5%8A%9F%E8%83%BD%E5%8F%91%E5%B8%83%EF%BC%9A">http://serverip/test或者http://serverip/jpress这种字样的URL，使用起来比较麻烦，所以呢，我们可以将tomcat和nginx结合在一起，可以通过nginx以下功能发布：</a></p><ul><li>使用nginx url重写</li><li>使用nginx的反向代理功能</li></ul><h3 id="一、部署tomcat网站"><a href="#一、部署tomcat网站" class="headerlink" title="一、部署tomcat网站"></a>一、部署tomcat网站</h3><p>通过部署两个tomcat站点，分别采用nginx url rewrite方法和反向代理发布。</p><ul><li>设置tomcat1</li></ul><pre><code>[root@zutuanxue ~]# cd /opt/tomcat1/webapps/[root@zutuanxue webapps]# mv ROOT tomcat[root@zutuanxue webapps]# mv jpress ROOT</code></pre><ul><li>设置tomcat2</li></ul><pre><code>[root@zutuanxue ~]# cd /opt/tomcat2/webapps/[root@zutuanxue webapps]# mv ROOT tomcat[root@zutuanxue webapps]# mv test ROOT</code></pre><h3 id="二、使用rewrite实现"><a href="#二、使用rewrite实现" class="headerlink" title="二、使用rewrite实现"></a>二、使用rewrite实现</h3><h4 id="2-1、部署nginx"><a href="#2-1、部署nginx" class="headerlink" title="2.1、部署nginx"></a>2.1、部署nginx</h4><pre><code>[root@zutuanxue ~]# dnf install nginx -y</code></pre><h4 id="2-2、设置nginx配置文件"><a href="#2-2、设置nginx配置文件" class="headerlink" title="2.2、设置nginx配置文件"></a>2.2、设置nginx配置文件</h4><pre><code>[root@zutuanxue ~]# vim /etc/nginx/nginx.conf[root@zutuanxue ~]# sed -i &#39;/#/d&#39; /etc/nginx/nginx.conf[root@zutuanxue ~]# sed -i &#39;/^$/d&#39; /etc/nginx/nginx.confserver &#123;        listen       80;        listen       [::]:80;        server_name  www.a.com;        location / &#123;                rewrite ^/$ http://127.0.0.1:8080/jpress break;        &#125;    &#125;    server &#123;        listen       80;        listen       [::]:80;127.0.0.1        server_name  www.b.com;        location / &#123;                rewrite ^/$ http://127.0.0.1:8081/test break;        &#125;    &#125;[root@zutuanxue ~]# systemctl restart nginx</code></pre><h4 id="2-3、修改测试机的hosts文件"><a href="#2-3、修改测试机的hosts文件" class="headerlink" title="2.3、修改测试机的hosts文件"></a>2.3、修改测试机的hosts文件</h4><pre><code>[root@zutuanxue conf]# vim /etc/hosts192.168.98.200  www.a.com192.168.98.200  www.b.com</code></pre><h4 id="2-4、-打开浏览器直接访问域名测试"><a href="#2-4、-打开浏览器直接访问域名测试" class="headerlink" title="2.4、 打开浏览器直接访问域名测试"></a>2.4、 打开浏览器直接访问域名测试</h4><p>测试方法：<br>打开浏览器输入之前设置好的域名<br><a href="http://www.a.com/">http://www.a.com</a><br><a href="http://www.b.com/">http://www.b.com</a><br>查看是否能访问到对应的网站内容，能看到说明实验成功。</p><h3 id="三、使用反向代理实现"><a href="#三、使用反向代理实现" class="headerlink" title="三、使用反向代理实现"></a>三、使用反向代理实现</h3><h4 id="3-1、设置nginx配置文件"><a href="#3-1、设置nginx配置文件" class="headerlink" title="3.1、设置nginx配置文件"></a>3.1、设置nginx配置文件</h4><pre><code>user nginx;worker_processes auto;error_log /var/log/nginx/error.log;pid /run/nginx.pid;include /usr/share/nginx/modules/*.conf;events &#123;    worker_connections 1024;&#125;http &#123;    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;    access_log  /var/log/nginx/access.log  main;    sendfile            on;    tcp_nopush          on;    tcp_nodelay         on;    keepalive_timeout   65;    types_hash_max_size 2048;    include             /etc/nginx/mime.types;    default_type        application/octet-stream;    include /etc/nginx/conf.d/*.conf;    server &#123;        listen       80;        listen       [::]:80;        server_name  www.a.com;        location / &#123;                proxy_pass http://127.0.0.1:8080;        &#125;    &#125;    server &#123;        listen       80;        listen       [::]:80;        server_name  www.b.com;        location / &#123;                proxy_pass http://127.0.0.1:8081;        &#125;    &#125;&#125;</code></pre><h4 id="3-2、打开浏览器直接访问域名测试"><a href="#3-2、打开浏览器直接访问域名测试" class="headerlink" title="3.2、打开浏览器直接访问域名测试"></a>3.2、打开浏览器直接访问域名测试</h4><p>测试方法：<br>打开浏览器输入之前设置好的域名<br><a href="http://www.a.com/">http://www.a.com</a><br><a href="http://www.b.com/">http://www.b.com</a><br>查看是否能访问到对应的网站内容，能看到说明实验成功。</p><h2 id="6、Tomcat调优"><a href="#6、Tomcat调优" class="headerlink" title="6、Tomcat调优"></a>6、Tomcat调优</h2><p>tomcat的优化可以提高网站的并发能力，体现个人的价值，tomcat在java项目中的使用率非常高，所以在生产环境对tomcat的优化也就变得非常必要了，一般情况下tomcat的优化主要从两个方面入手，一个是自身配置，另一个是tomcat所运行的jvm虚拟机的优化，优化的工作可以从安装完tomcat就开始着手</p><h3 id="一、AJP优化"><a href="#一、AJP优化" class="headerlink" title="一、AJP优化"></a>一、AJP优化</h3><p>在前面的课程中我们提到了一个叫AJP的协议，同时我们也知道了这个AJP的作用，但是在生产环境中一般使用的是nginx+tomcat的架构，所以大多数时候用不到AJP协议，所以我们可以禁用它，而在我们的server.xml文件中这个AJP默认就是禁用的,如果是其它版本最好看一下</p><pre><code> [root@zutuanxue conf]# vim /opt/tomcat1/conf/server.xml  &lt;!--    &lt;Connector protocol=&quot;AJP/1.3&quot;               address=&quot;::1&quot;               port=&quot;8009&quot;               redirectPort=&quot;8443&quot; /&gt;    --&gt;</code></pre><h3 id="二、运行模式优化"><a href="#二、运行模式优化" class="headerlink" title="二、运行模式优化"></a>二、运行模式优化</h3><p>tomcat的运行模式有3种：</p><h4 id="bio"><a href="#bio" class="headerlink" title="bio"></a><strong>bio</strong></h4><p>性能非常低下，没有经过任何优化处理和支持，适用于连接数目比较小且固定的架构，这种方式对服务器资源要求比较高，并发局限于应用中，JDK1.4以前的唯一选择，但程序直观简单易理解。</p><h4 id="nio"><a href="#nio" class="headerlink" title="nio"></a><strong>nio</strong></h4><p>nio(new I&#x2F;O)，是Java SE 1.4及后续版本提供的一种新的I&#x2F;O操作方式它拥有比传统I&#x2F;O操作(bio)更好的并发运行性能。Tomcat9默认使用nio运行模式。适用于连接数目多且连接比较短（轻操作）的架构，比如聊天服务器，并发局限于应用中，编程比较复杂。AIO(NIO2)使用于连接数目多且连接比较长（重操作）的架构，比如相册服务器，充分调用OS参与并发操作，编程比较复杂，JDK7开始支持。</p><h4 id="apr"><a href="#apr" class="headerlink" title="apr"></a><strong>apr</strong></h4><p>安装起来最困难，但是从操作系统级别来解决异步的IO问题，大幅度的提高性能</p><p>进入tomcat的服务器状态页面查看默认的模式</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603162047961.png" alt="image20200313202144717.png"></p><p>如果默认使用的是bio模式</p><pre><code>设置使用nio模式[root@zutuanxue logs]# vim /opt/tomcat1/conf/server.xml&lt;Connector  port=&quot;8080&quot;protocol=&quot;org.apache.coyote.http11.Http11NioProtocol&quot; connectionTimeout=&quot;20000&quot;               redirectPort=&quot;8443&quot; /&gt;</code></pre><h3 id="apr运行模式"><a href="#apr运行模式" class="headerlink" title="apr运行模式"></a>apr运行模式</h3><p>APR(Apache portable Run-time libraries，Apache可移植运行库)的目的如其名称一样，主要为上层的应用程序提供一个可以跨越多操作系统平台使用的底层支持接口库。可以大大地提高Tomcat对静态文件的处理性能。 也是在Tomcat上运行高并发应用的首选模式。</p><p>系统自带的软件包不是最新的，且缺少相关软件包，所以我们选择源码包安装</p><p>所需软件包</p><p>apr-1.7.0.tar.gz 主程序包 包含了通用开发组件</p><p>apr-iconv-1.2.2.tar.gz 用于实现iconv编码</p><p>apr-util-1.6.1.tar.gz 额外的开发组件</p><p>tomcat-native.tar.gz 关联tomcat和apr的组件</p><p>arp相关软件包下载 <a href="https://mirrors.cnnic.cn/apache/apr/">https://mirrors.cnnic.cn/apache/apr/</a></p><p>tomcat-native在tomcat安装目录的bin下</p><h3 id="部署apr环境"><a href="#部署apr环境" class="headerlink" title="部署apr环境"></a>部署apr环境</h3><p><strong>step 1</strong> 环境准备</p><pre><code>[root@zutuanxue ~]# dnf install -y apr-devel openssl-devel gcc make expat-devel libtool </code></pre><p><strong>step 2</strong> 安装apr主程序包</p><pre><code>[root@zutuanxue ~]# tar fx apr-1.7.0.tar.gz [root@zutuanxue ~]# cd apr-1.7.0/[root@zutuanxue ~]# ./configure --prefix=/usr/local/apr[root@zutuanxue apr-1.7.0]# make -j4 &amp;&amp; make install</code></pre><p><strong>step 3</strong> 安装apr-iconv</p><pre><code>[root@zutuanxue ~]# tar fx apr-iconv-1.2.2.tar.gz [root@zutuanxue ~]# cd apr-iconv-1.2.2/[root@zutuanxue ~]# ./configure   --with-apr=/usr/local/apr  --prefix=/usr/local/apr-iconv[root@zutuanxue apr-iconv-1.2.2]# make -j4 &amp;&amp; make install</code></pre><p><strong>step 4</strong> 安装apr-util</p><pre><code>[root@zutuanxue ~]# tar fx apr-util-1.6.1.tar.gz [root@zutuanxue ~]# cd apr-util-1.6.1/[root@zutuanxue ~]# ./configure --prefix=/usr/local/apr-util  --with-apr=/usr/local/apr   --with-apr-iconv=/usr/local/apr-iconv/bin/apriconv[root@zutuanxue apr-util-1.6.1]# make -j4 &amp;&amp; make install</code></pre><p><strong>step 5</strong> 安装tomcat-native</p><pre><code>[root@zutuanxue ~]# cd /opt/tomcat1/bin/[root@zutuanxue bin]# tar fx tomcat-native.tar.gz [root@zutuanxue bin]# cd tomcat-native-1.2.23-src/native[root@zutuanxue tomcat-native-1.2.23-src]# ./configure --with-apr=/usr/local/apr  --with-java-home=/usr/java/jdk-13.0.2[root@zutuanxue tomcat-native-1.2.23-src]# make -j4 &amp;&amp; make install</code></pre><p><strong>step 6</strong> 修改并加载环境变量</p><pre><code>[root@zutuanxue ~]# echo &#39;export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/apr/libexport LD_RUN_PATH=$LD_RUN_PATH:/usr/local/apr/lib&#39; &gt;&gt; /etc/profile[root@zutuanxue ~]# source /etc/profile</code></pre><p><strong>step 7</strong> 修改tomcat配置文件</p><pre><code>[root@zutuanxue ~]# vim /opt/tomcat1/conf/server.xml    protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot;               connectionTimeout=&quot;20000&quot;               redirectPort=&quot;8443&quot; /&gt;</code></pre><p><strong>step 8</strong> 测试</p><pre><code>#为了避免干扰先执行关闭[root@zutuanxue ~]# sh /opt/tomcat1/bin/shutdown.sh #测试[root@zutuanxue ~]# sh /opt/tomcat1/bin/catalina.sh run#如果没有问题可以看到14-Mar-2020 00:22:23.894 信息 [main] org.apache.coyote.AbstractProtocol.start 开始协议处理句柄[&quot;http-apr-8080&quot;]</code></pre><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/20/1603162079362.png" alt="image20200314122328676.png"></p><pre><code>注意：如果非root用户启动失败，把apr环境变量在当前用户的.bash_profile中写一份[root@zutuanxue ~]# echo &#39;export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/apr/libexport LD_RUN_PATH=$LD_RUN_PATH:/usr/local/apr/lib&#39; &gt;&gt; /root/.bash_profile[root@zutuanxue ~]# source /root/.bash_profile</code></pre><h3 id="其它优化参数"><a href="#其它优化参数" class="headerlink" title="其它优化参数"></a>其它优化参数</h3><pre><code>[root@zutuanxue logs]# vim /opt/tomcat1/conf/server.xml  &lt;Connector  port=&quot;8080&quot;            protocol=&quot;HTTP/1.1              enableLookups=&quot;false&quot;                maxThreads=&quot;1000&quot;                minSpareThreads=&quot;100&quot;                acceptCount=&quot;900&quot;                disableUploadTimeout=&quot;true&quot;                connectionTimeout=&quot;20000&quot;                URIEncoding=&quot;UTF-8&quot;                redirectPort=&quot;8443&quot;compression=&quot;on&quot;                compressionMinSize=&quot;1024&quot;                useSendfile=&quot;false&quot;                noCompressionUserAgents=&quot;mozilla, traviata&quot;                compressibleMimeType=&quot;text/html,text/xml,text/plain,text/css,text/javascript,application/javascript &quot;  /&gt;maxThreads：最大线程数，默认150。增大值避免队列请求过多，导致响应缓慢。minSpareThreads：最小空闲线程数。acceptCount：当处理请求超过此值时，将后来请求放到队列中等待。disableUploadTimeout：禁用上传超时时间connectionTimeout：连接超时，单位毫秒，0代表不限制URIEncoding：URI地址编码使用UTF-8enableLookups：关闭dns解析，提高响应时间compression：启用压缩功能compressionMinSize：最小压缩大小，单位BytecompressibleMimeType ：压缩的文件类型官方参数文档：http://tomcat.apache.org/tomcat-9.0-doc/config/http.html</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>shell脚本</title>
      <link href="/2023/04/16/shell%E8%84%9A%E6%9C%AC/"/>
      <url>/2023/04/16/shell%E8%84%9A%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h1 id="Shell变量"><a href="#Shell变量" class="headerlink" title="Shell变量"></a>Shell变量</h1><h2 id="一、变量介绍"><a href="#一、变量介绍" class="headerlink" title="一、变量介绍"></a>一、变量介绍</h2><p>在编程中，我们总有一些数据需要临时存放在内存，以待后续使用时快速读出。先了解一下计算机的存储单位吧。</p><pre><code>计算机的单位:1B=8bit1KB=1024B1MB=1024KB1GB=1024MB1TB=1024GB1PB=1024TB1EB=1024PB1ZB=1024EB...好了，已经够大了！当然还有YB、BB更大的单位，同样进制也是1024.1G=1024*1024*1024=1073741824B</code></pre><p>假如你将一个1B的字符存入内存，如何读出呢？有没有一种大海捞针的感觉啊！我们讨论一下计算机是如何通过让我们人类快速将数据存在内存，如何从内存中读出数据的。我们研究过变量后就明白了。</p><p>变量：变量是编程中最常用的一种临时在内存中存取数据的一种方式。</p><p>变量存取原理</p><pre><code>关于内存的说明a、系统启动    内存被按照1B一个单位划分成N块     并且以十六进制为每一个空间编号b、内存跟踪表记录  使用和未使用的内存的地址编号c、内存申请    系统从未使用的内存中拿出一个或者一段连续空间  给你使用   同时在内存跟踪表中记录该地址被占用不在分给别人，同时在系统中建立映射机制   比如:变量名 STRING1=‘ABC’name&lt;==&gt;0x5d、释放内存从内存跟踪表中将记录删除，下次存数据直接覆盖</code></pre><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/21/1600685218168.png" alt="变量存储.png"></p><pre><code>CHAR1(0x3)=A从图片可以看出，当我们在脚本中定义变量存值的时候，可以从以下方面看到变化：a、内存占用：如果存的是一个字符则占用1个字节，如果存的是字符串则是字符串的长度加1个字节长度(\0是一个特殊字符，代表字符串结束)。b、变量名与内存空间关系：计算机中会将对应的内存空间地址和变量名称绑定在一起，此时代表这段内存空间已经被程序占用，其他程序不可复用；然后将变量名对应的值存在对应内存地址的空间里。</code></pre><h2 id="二、变量定义"><a href="#二、变量定义" class="headerlink" title="二、变量定义"></a>二、变量定义</h2><h3 id="2-1-什么时候需要定义变量？"><a href="#2-1-什么时候需要定义变量？" class="headerlink" title="2.1 什么时候需要定义变量？"></a>2.1 什么时候需要定义变量？</h3><p>如果某个内容需要多次使用，并且在代码中重复出现，那么可以用变量代表该内容。这样在修改内容的时候，仅仅需要修改变量的值。<br>在代码运作的过程中，可能会把某些命令的执行结果保存起来，后续代码需要使用这些结果，就可以直接使用这个变量。</p><h3 id="2-2-定义一个变量"><a href="#2-2-定义一个变量" class="headerlink" title="2.2 定义一个变量"></a>2.2 定义一个变量</h3><p>变量格式： 变量名&#x3D;值</p><p>在shell编程中的变量名和等号之间不能有空格。</p><pre><code>变量名命名规则：    命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。    中间不能有空格，可以使用下划线（_）。    不能使用标点符号。    不能使用bash里的关键字（可用help命令查看保留关键字）。</code></pre><p>定义变量举例：<br>VAR1&#x3D;1<br>age&#x3D;18 整形<br>name&#x3D;‘baism’ 字符串<br>score&#x3D;88.8 浮点</p><pre><code>注意：字符串要用单引号或双引号引起来建议变量名为大写，和命令区分            _name</code></pre><p>定义变量演示：</p><pre><code>变量赋值，此种方法设置为本地变量[root@zutuanxue ~]# name=&quot;baism&quot;[root@zutuanxue ~]# school=&#39;ayitula&#39;[root@zutuanxue ~]# age=30[root@zutuanxue ~]# score=88.8</code></pre><h3 id="2-3-取消变量-unset"><a href="#2-3-取消变量-unset" class="headerlink" title="2.3 取消变量 unset"></a>2.3 取消变量 unset</h3><pre><code>取消当前环境中的变量，如果是变量设置是保存在文件中，下次重启又会恢复[root@zutuanxue ~]# unset name[root@zutuanxue ~]# echo $name</code></pre><h3 id="2-4-有类型变量-declare"><a href="#2-4-有类型变量-declare" class="headerlink" title="2.4 有类型变量 declare"></a>2.4 有类型变量 declare</h3><p>-i 将变量看成整数<br>-r 使变量只读 readonly,该变量的值无法改变，并且不能为unset<br>-x 标记变量通过环境导出 export<br>-a 指定为索引数组（普通数组）；查看普通数组<br>-A 指定为关联数组；查看关联数组</p><pre><code>[root@zutuanxue ~]# declare -i num=&#39;asa&#39;[root@zutuanxue ~]# echo $num0[root@zutuanxue ~]# num=100[root@zutuanxue ~]# echo $num100[root@zutuanxue ~]# declare -r num[root@zutuanxue ~]# echo $num100[root@zutuanxue~]# num=200-bash: num: 只读变量[root@zutuanxue ~]# declare -xdeclare -x HISTCONTROL=&quot;ignoredups&quot;declare -x HISTSIZE=&quot;1000&quot;declare -x HOME=&quot;/root&quot;declare -x HOSTNAME=&quot;Bai_Shuming&quot;declare -x LANG=&quot;zh_CN.UTF-8&quot;declare -x LESSOPEN=&quot;||/usr/bin/lesspipe.sh %s&quot;</code></pre><h2 id="三、变量分类"><a href="#三、变量分类" class="headerlink" title="三、变量分类"></a>三、变量分类</h2><p>系统中的变量根据作用域及生命周期可以分为四类：本地变量、环境变量、全局变量、内置变量</p><h3 id="3-1-本地变量"><a href="#3-1-本地变量" class="headerlink" title="3.1 本地变量"></a>3.1 本地变量</h3><p>用户自定义的变量，定义在脚本或者当前终端中，脚本执行完毕或终端结束变量失效。</p><h3 id="3-2-环境变量"><a href="#3-2-环境变量" class="headerlink" title="3.2 环境变量"></a>3.2 环境变量</h3><p>定义在用户家目录下的.bashrc或.bash_profile文件中，用户私有变量，只能本用户使用。</p><p>查看当前用户的环境变量 env</p><p>查询当前用户的所有变量(临时变量与环境变量) set</p><h3 id="3-3-将当前变量变成环境变量-export"><a href="#3-3-将当前变量变成环境变量-export" class="headerlink" title="3.3 将当前变量变成环境变量 export"></a>3.3 将当前变量变成环境变量 export</h3><pre><code>定义一个临时变量1、[root@zutuanxue tmp]# export A=hello //临时将一个本地变量（临时变量）变成环境变量[root@zutuanxue tmp]# env|grep ^AA=hello2、[root@zutuanxue tmp]# A=HELLO[root@zutuanxue tmp]# export A3、定义一个永久生效变量：vim .bash_profile 或者 ~/.bashrcA=hello关于export说明用户登录时:1) 用户登录到Linux系统后，系统将启动一个用户shell。在这个shell中，可以使用shell命令或声明变量，也可以创建并运行 shell脚本程序。运行脚本时:2) 运行shell脚本程序时，系统将创建一个子shell。此时，系统中将有两个shell，一个是登录时系统启动的shell，另一个是系统为运行脚本程序创建的shell。当一个脚本程序运行完毕，它的脚本shell将终止，可以返回到执行该脚本之前的shell。从这种意义上来说，用户可以有许多 shell，每个shell都是由某个shell（称为父shell）派生的。在子shell中定义的变量只在该子shell内有效。如果在一个shell脚本程序中定义了一个变量，当该脚本程序运行时，这个定义的变量只是该脚本程序内的一个局部变量，其他的shell不能引用它，要使某个变量的值可以在其他shell中被改变，可以使用export命令对已定义的变量进行输出。 export命令将使系统在创建每一个新的shell时定义这个变量的一个拷贝。这个过程称之为变量输出。</code></pre><p>父shell与子shell</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/9/21/1600685550727.png" alt="shell父子关系.png"></p><h3 id="3-4-全局变量"><a href="#3-4-全局变量" class="headerlink" title="3.4 全局变量"></a>3.4 全局变量</h3><p>使用export命令将本地变量输出为当前shell中的环境变量<br>所有用户及shell都可以使用，可以在&#x2F;etc&#x2F;profile &#x2F;etc&#x2F;bashrc下永久定义</p><pre><code>打印全局变量 printenv定义格式export SCHOOL=&#39;zutuanxue&#39;测试方法：通过不同用户登录测试是否能读取变量</code></pre><h3 id="3-5-内置变量"><a href="#3-5-内置变量" class="headerlink" title="3.5 内置变量"></a>3.5 内置变量</h3><p>系统变量(内置bash中变量) ： shell本身已经固定好了它的名字和作用.</p><pre><code>$?：上一条命令执行后返回的状态，当返回状态值为0时表示执行正常，非0值表示执行异常或出错 若退出状态值为0，表示命令运行成功 若退出状态值为127,表示command not found 若退出状态值为126,表示找到了该命令但无法执行（权限不够） 若退出状态值为1&amp;2,表示没有那个文件或目录 $$：当前所在进程的进程号     echo $$   eg：kill -9 `echo $$`  = exit   退出当前会话$!：后台运行的最后一个进程号  （当前终端）  # gedit &amp;!$ 调用最后一条命令历史中的参数!! 调用最后一条命令历史$#：脚本后面接的参数的个数$*：脚本后面所有参数，参数当成一个整体输出，每一个变量参数之间以空格隔开$@: 脚本后面所有参数，参数是独立的，也是全部输出$0：当前执行的进程/程序名  echo $0     $1~$9 位置参数变量$&#123;10&#125;~$&#123;n&#125; 扩展位置参数变量  第10个位置变量必须用&#123;&#125;大括号括起来./1.sh a b c[root@zutuanxue shell01]# cat 2.sh #!/bin/bash#xxxxecho &quot;\$0 = $0&quot;echo &quot;\$# = $#&quot;echo &quot;\$* = $*&quot;echo &quot;\$@ = $@&quot;echo &quot;\$1 = $1&quot; echo &quot;\$2 = $2&quot; echo &quot;\$3 = $3&quot; echo &quot;\$11 = $&#123;11&#125;&quot; echo &quot;\$12 = $&#123;12&#125;&quot; 了解$*和$@的区别：$* :表示将变量看成一个整体$@ :表示变量是独立的#!/bin/bashfor i in &quot;$@&quot;doecho $idoneecho &quot;======我是分割线=======&quot;for i in &quot;$*&quot;doecho $idone[root@zutuanxue shell01]# bash 3.sh a b cabc======我是分割线=======a b c</code></pre><p>变量总结说明：</p><p>本地变量：当前用户自定义的变量。当前进程中有效，其他进程及当前进程的子进程无效。</p><p>环境变量：当前进程有效，并且能够被子进程调用。</p><p>全局变量：全局所有的用户和程序都能调用，且继承，新建的用户也默认能调用.</p><p>内置变量：shell本身已经固定好了它的名字和作用.</p><table><thead><tr><th>变量类型</th><th>作用域</th><th>生命周期</th></tr></thead><tbody><tr><td>本地变量</td><td>当前shell环境(子shell不能用)</td><td>脚本结束或终端结束</td></tr><tr><td>环境变量</td><td>当前shell或者子shell</td><td>当前进程结束</td></tr><tr><td>全局变量</td><td>所有用户及shell环境</td><td>关机</td></tr><tr><td>内置变量</td><td>所有用户及shell环境</td><td>关机</td></tr></tbody></table><h2 id="四、变量取值"><a href="#四、变量取值" class="headerlink" title="四、变量取值"></a>四、变量取值</h2><p>读取变量内容符: 读取方法：变量名</p><pre><code>变量内容读出[root@zutuanxue ~]# echo $namebaism[root@zutuanxue ~]# echo $schoolayitula[root@zutuanxue ~]# echo $age30[root@zutuanxue ~]# echo $score88.8</code></pre><p><strong>注意</strong></p><pre><code>变量读取过程中，默认单引号是不解释变量的.比如[root@zutuanxue ~]# echo &#39;$name&#39;$name如果必须使用单引号还要读取变量的值可以使用eval命令[重新运算求出参数的内容] [root@zutuanxue ~]# eval  echo &#39;$name&#39;baism</code></pre><h2 id="五、其他变量（扩展）"><a href="#五、其他变量（扩展）" class="headerlink" title="五、其他变量（扩展）"></a>五、其他变量（扩展）</h2><pre><code>1）取出一个目录下的目录和文件：dirname和 basename 2）变量&quot;内容&quot;的删除和替换一个“%”代表从右往左去掉一个/key/两个“%%”代表从右往左最大去掉/key/一个“#”代表从左往右去掉一个/key/两个“##”代表从左往右最大去掉/key/# A=/root/Desktop/shell/mem.txt # echo $A/root/Desktop/shell/mem.txt# dirname $A   取出目录/root/Desktop/shell# basename $A  取出文件mem.txt# url=www.taobao.com# echo $</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux基本优化</title>
      <link href="/2023/03/29/Linux%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96/"/>
      <url>/2023/03/29/Linux%E5%9F%BA%E6%9C%AC%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="一、selinux和防火墙优化"><a href="#一、selinux和防火墙优化" class="headerlink" title="一、selinux和防火墙优化"></a>一、selinux和防火墙优化</h2><h3 id="1、SElinux"><a href="#1、SElinux" class="headerlink" title="1、SElinux"></a>1、SElinux</h3><p>selinux 安全增强型 Linux（Security-Enhanced Linux）简称 SELinux，它是一个 Linux 内核模块，也是 Linux 的一个安全子系统。SELinux 主要由美国国家安全局开发。它的主要 作用就是最大限度地减小系统中服务进程可访问的资源（最小权限原则）。也由于它的这个原则，导致我们很多操作无法正确的执行，所以对于初学者而言在会用selinux之前我们要把这个子系统关闭</p><p><strong>SELinux 的工作模式</strong></p><p>SELinux 有三种工作模式，分别是：</p><pre><code>- enforcing：强制模式。违反 SELinux 规则的行为将被阻止并记录到日志中。- permissive：宽容模式。违反 SELinux 规则的行为只会记录到日志中。一般为调试用。- disabled：关闭 SELinux。</code></pre><p><strong>SElinux工作模式设置方法</strong></p><ul><li>临时设置<br>enforcing 和 permissive 模式可以通过 setenforce 1|0 命令快速切换,重启系统后失效。</li><li>永久生效<br>SELinux 工作模式可以在 &#x2F;etc&#x2F;selinux&#x2F;config 中设定。</li></ul><pre><code>如果想从 disabled 切换到 enforcing 或者 permissive 的话，需要重启系统。反过来也一样。</code></pre><p>需要注意的是，如果系统已经在关闭 SELinux 的状态下运行了一段时间，在打开 SELinux 之后的第一次重启速度可能会比较慢。因为系统必须为磁盘中的文件创建安全上下文，我们现在来看一下如何关闭selinux，首先用root的身份登录系统，打开一个终端输入gedit &#x2F;etc&#x2F;selinux&#x2F;config命令，回车之后会打开一个文件，将所标记出来部分的enforcing改为disabled，保存之后重启linux系统</p><pre><code>[root@zutuanxue ~]# gedit /etc/selinux/config##/etc/selinux/config  内容# This file controls the state of SELinux on the system.# SELINUX= can take one of these three values:#     enforcing - SELinux security policy is enforced.#     permissive - SELinux prints warnings instead of enforcing.#     disabled - No SELinux policy is loaded.SELINUX=enforcing     #这里定义selinux是否为开启状态# SELINUXTYPE= can take one of these three values:#     targeted - Targeted processes are protected,#     minimum - Modification of targeted policy. Only selected processes are protected. #     mls - Multi Level Security protection.SELINUXTYPE=targeted   #这里定义的是selinux保护级别</code></pre><p>重启登录之后可以使用sestatus -v命令去查看是否成功，如果看到的状态不是disabled则需要重新操作</p><pre><code>[root@zutuanxue ~]# sestatus -vSELinux status:                 disabled</code></pre><h3 id="2、防火墙"><a href="#2、防火墙" class="headerlink" title="2、防火墙"></a>2、防火墙</h3><p>防火墙技术是通过有机结合各类用于安全管理与筛选的软件和硬件设备，帮助计算机网络于其内、外网之间构建一道相对隔绝的保护屏障，以保护用户资料与信息安全性的一种技术。 在CentOS8中使用firewalld作为防火墙，基于iptables的防火墙被默认不启动，但仍然可以继续使用。CentOS8中有几种防火墙共存：firewalld、iptables、ebtables等，默认使用firewalld作为防火墙，通过firewall-cmd工具来管理netfilter,不过底层调用的命令仍然是iptables，虽然防火墙是安全软件，但是它的一些默认设置会对初学者造成困扰，所以我们要先关闭firewalld。通过systemctl stop firewalld.service停止防火墙，systemctl disable firewalld.service禁止防火墙服务开机启动，接下来我们看一下如何设置中文</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389727708.png" alt="1571044294838.png"></p><h2 id="二、中文设置优化"><a href="#二、中文设置优化" class="headerlink" title="二、中文设置优化"></a>二、中文设置优化</h2><p>我们在安装系统选择的是中文，但是我们系统当中并没有中文输入法，所以如果要想输入中文的话需要添加中文输入法，以root用户身份登录系统之后我们使用gedit &#x2F;etc&#x2F;yum.repos.d&#x2F;server.repo,输入如下内容保存退出，确保虚拟机的光驱中加载的是CentOS8的光盘镜像，并且已连接<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389773586.png" alt="1571048414719.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389785159.png" alt="1571047694890.png"></p><p>设置完成之后执行mkdir命令建立目录，然后挂载光盘</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389813049.png" alt="1571047821170.png"></p><p>光盘挂载完成之后执行输入法安装命令，如果只要拼音则安装的是： ibus-libpinyin.x86_64</p><pre><code># 安装所有支持的输入法[root@zutuanxue ~]# dnf install ibus* -y# 或者 精准安装拼音输入法[root@zutuanxue ~]#  dnf install ibus-libpinyin.x86_64 -y</code></pre><p>等待软件包安装完成之后重启系统然后重新登录</p><pre><code>如果不想重启系统可以使用[root@zutuanxue ~]# ibus restart 命令重启ibus-daemon进程来实现</code></pre><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389829983.png" alt="1571048752409.png"></p><p>安装完成之后点击右上角的按钮然后点击设置</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389850869.png" alt="1571048826875.png"></p><p>在新打开的窗口中找到语言，选择添加，选择汉语，然后选择一个适合自己的中文输入法点击添加之后就可以使用中文输入法了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389866470.png" alt="1571048904227.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389893147.png" alt="1571049215146.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389909572.png" alt="1571049244944.png"></p><p>输入法设置完成之后，我们来看下时间相关的设置</p><h2 id="三、网络时间服务器优化"><a href="#三、网络时间服务器优化" class="headerlink" title="三、网络时间服务器优化"></a>三、网络时间服务器优化</h2><p>如果系统的时间不准，自己手动设置起来比较麻烦，我们可以看下怎么来优化一下</p><p>同样还是找到设置，在里面找到详细信息，展开之后可以看到日期和时间的设置，两个自动设置的选项打开，如果你的虚拟机可以联网的话，过一会就会看到时间正常了</p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389925235.png" alt="1571049564017.png"></p><p><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389936841.png" alt="1571049605979.png"><br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389949009.png" alt="1571049727212.png"></p><h2 id="四、自启动服务优化"><a href="#四、自启动服务优化" class="headerlink" title="四、自启动服务优化"></a>四、自启动服务优化</h2><p>自启动服务优化的方式类似我们之前提到的停止firewalld，但是首先我们要确认一下有哪些服务是开机启动的，然后利用之前用过的systemctl stop servername和systemctl disabled servername这两条命令停止相应的服务，比如说蓝牙服务和防火墙服务，但是各位需要注意的是，这里面所涉及的服务在你不了解的前提下不要乱停止，否则可能会导致系统功能失灵，甚至是崩溃<br><img src="https://www.zutuanxue.com:8000/static/media/images/2020/10/11/1602389969693.png" alt="1571050099841.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux常用命令与符号</title>
      <link href="/2023/03/26/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%90%88%E9%9B%86/"/>
      <url>/2023/03/26/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%90%88%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h2 id="一、常用命令介绍"><a href="#一、常用命令介绍" class="headerlink" title="一、常用命令介绍"></a>一、常用命令介绍</h2><p>在linux系统中存在很多命令，这些命令可以帮助我们完成不同的工作，在这里面我们先介绍一些常用的基础命令，这些命令可以帮助我们完成对应的基本操作，随着以后的学习，我们还会接触到更多可以帮助我们完成不同工作的linux命令，我们来一起看一下这些基础命令都有哪些</p><p><strong>1、关机、重启命令</strong></p><p><strong>关机命令</strong></p><ul><li>init 0 #管理员可以使用</li><li>halt</li><li>shutdown -h</li><li>poweroff</li></ul><p><strong>重启命令</strong></p><ul><li>shutdown -r</li><li>reboot</li><li>shutdown -r</li></ul><p>强烈推荐：关机或重启命令及步骤</p><pre><code>1） sync：将缓冲区的数据同步到磁盘中(关机，重启前都需要执行，避免数据丢失)，在Linux系统中，当数据需要存入磁盘时，通常会先放到缓冲区内，等到适当的时刻再写入磁盘，如此可提高系统的执行效率2） shutdown： 以一种安全的方式关闭或重启系统。所有登陆用户都可以看到关机信息提示，并且禁止登陆    -k并非真正关机，只向所有人显示警告信息。        如：shutdown -k +5    -r重启。默认延迟一分钟        如：shutdown -r +3 &quot;shutdown in 3 minutes&quot;    -h关机。默认延迟一分钟        如：shutdown -h 12：00/shutdown -h now    -f重启时跳过磁盘检测。    -F重启时强制磁盘检测。    -c取消shutdown推荐理由：1、将内存中的数据刷入硬盘，避免因为重启或关机数据没有及时保存而丢失2、避免多用户使用突然某个用户强行关机，影响其他用户，使用shutdown关机和重启可以通知其他用户，给予缓冲时间</code></pre><p><strong>2、系统信息</strong></p><ul><li>uname</li></ul><pre><code>-s  输出内核名称-n  输出网络节点上的主机名-r  输出内核发行号-v  输出内核版本-m  输出主机的硬件架构名称-p  输出处理器类型或&quot;unknown&quot;-i输出硬件平台或&quot;unknown&quot;-o输出操作系统名称-a  以如下次序输出所有信息。其中若-p和-i的结果不可知则省略</code></pre><ul><li>hostname 查看主机名</li></ul><pre><code># hostnamectl set-hostname hello</code></pre><ul><li>date 查看和设置时间</li></ul><pre><code>时间方面：%n : 下一行%t : 跳格 tab%H : 小时(00..23)%I : 小时(01..12)%k : 小时(0..23)%l : 小时(1..12)%M : 分钟(00..59)%p : 显示本地 AM 或 PM%r : 直接显示时间 (12 小时制，格式为 hh:mm:ss [AP]M)%s : 从 1970 年 1 月 1 日 00:00:00 UTC 到目前为止的秒数%S : 秒(00..60)%T : 直接显示时间 (24 小时制)%X : 相当于 %H:%M:%S%Z : 显示时区日期方面：%a : 星期几 (Sun..Sat)%A : 星期几 (Sunday..Saturday)%b : 月份 (Jan..Dec)%B : 月份 (January..December)%c : 直接显示日期与时间%d : 日 (01..31)%D : 直接显示日期 (mm/dd/yy)%h : 同 %b%j : 一年中的第几天 (001..366)%m : 月份 (01..12)%U : 一年中的第几周 (00..53) (以 Sunday 为一周的第一天的情形)%w : 一周中的第几天 (0..6)%W : 一年中的第几周 (00..53) (以 Monday 为一周的第一天的情形)%x : 直接显示日期 (yyyy-mm-dd)%y : 年份的最后两位数字 (00.99)%Y : 完整年份 (0000..9999)[root@zutuanxue ~]# date &#39;+%I%M%S&#39;025929[root@zutuanxue ~]# date &#39;+%r&#39;上午 02时59分49秒[root@zutuanxue ~]# date &#39;+%s&#39;1584428402[root@zutuanxue ~]# date &#39;+%Z&#39;EDT[root@zutuanxue ~]# date &#39;+%a&#39;二[root@zutuanxue ~]# date &#39;+%A&#39;星期二[root@zutuanxue ~]# date &#39;+%b&#39;3月[root@zutuanxue ~]# date &#39;+%B&#39;三月[root@zutuanxue ~]# date &#39;+%c&#39;2020年03月17日 星期二 03时01分36秒[root@zutuanxue ~]# date &#39;+%T%n%D&#39;03:03:3503/17/20[root@zutuanxue ~]# date &#39;+%T%t%D&#39;03:03:5803/17/20[root@zutuanxue ~]# date -s 2021-10-252021年 10月 25日 星期一 00:00:00 EDT[root@zutuanxue ~]# date -s 18:002021年 10月 25日 星期一 18:00:00 EDT[root@zutuanxue ~]# date -s 18:30:212021年 10月 25日 星期一 18:30:21 EDT[root@zutuanxue ~]# date -s &quot;2021-04-28 15:30:20&quot;2021年 04月 28日 星期三 15:30:20 EDT</code></pre><p><strong>3、文件和目录</strong></p><ul><li>cd 目录 进入目录</li><li>pwd： 查看当前的工作路径</li></ul><pre><code>-P显示实际位置-L显示所在位置[root@zutuanxue ~]# cd /etc     #进入到/etc这个目录[root@zutuanxue ~]# cd /[root@zutuanxue /]# lsbin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var[root@zutuanxue /]# cd bin/[root@zutuanxue bin]# pwd/bin[root@zutuanxue bin]# pwd -P/usr/bin[root@zutuanxue bin]# pwd -L/bin</code></pre><ul><li>ls： 查看当前目录下有哪些文件</li></ul><pre><code>-a 列出目录下的所有文件，包括以 . 开头的隐含文件。-A 显示除 “.”和“..”外的所有文件。-B 不输出以 “~”结尾的备份文件。-c 与lt一起使用，显示并按照修改时间（ctime）排序，与l一起使用，显示修改时间，按名称排序。-d 将目录象文件一样显示，而不是显示其下的文件。-f 对输出的文件不排序，使用此选项后aU选项生效，lst选项失效-F 在每个文件名后附上一个字符以说明该文件的类型，“*”表示可执行的普通文件；“/”表示目录；“@”表示符号链接；“|”表示FIFOs；“=”表示套接字(sockets)。-g 类似l但是不显示所有者-h 与l一起，以易于阅读的格式输出文件大小(例如 1K 234M 2G)-i 输出文件的i节点的索引信息。-k 以k字节的形式表示文件的大小。--si类似k但是以1000为进制而非1024-l 列出文件的详细信息。-L 遇到链接文件是，显示原文件的信息，而非链接信息-m 横向输出文件名，并以“，”作分格符。-n 类似l,但是用数字的 UID,GID 代替名称。-o 显示文件的除组信息外的详细信息。-p 目录后面加上/标识-q 用?代替不可输出的字符。-r 对目录反向排序。-s 在每个文件名后输出该文件的大小。-t 以修改时间排序。-u 与lt一起使用，以访问时间(atime)排序；与l一起使用显示访问时间，按照名称排序-x 按列输出，横向排序。-Q 把输出的文件名用双引号括起来。-R 列出所有子目录下的文件。-S 以文件大小排序。-X 以文件的扩展名(最后一个 . 后的字符)排序。-1 一行只输出一个文件。--color=no 不显示彩色文件名--help 在标准输出上显示帮助信息。--version 在标准输出上输出版本信息并退出。</code></pre><ul><li>mkdir 建立目录</li></ul><pre><code>-m设置权限模式(类似chmod)-p需要时创建目标目录的上层目录，但即使这些目录已存在也不当作错误处理-v每次创建新目录都显示信息-Z将每个创建的目录的SELinux 安全环境设置为CTX</code></pre><ul><li>rmdir 删除空文件夹</li></ul><pre><code>-p  递归删除空目录，从最后一个目录倒删</code></pre><ul><li>touch 建立文件</li></ul><pre><code>-a只更改访问时间-c不创建任何文件-m只更改修改时间-r使用指定文件的时间属性替代当前时间-t使用[[CC]YY]MMDDhhmm[.ss] 格式的时间替代当前时间[root@zutuanxue ~]# stat hello  文件：hello  大小：0         块：0          IO 块：4096   普通空文件设备：fd00h/64768dInode：34502264    硬链接：1权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)最近访问：2020-03-17 16:51:35.502961371 -0400最近更改：2020-03-17 16:51:35.502961371 -0400最近改动：2020-03-17 16:51:35.502961371 -0400创建时间：-[root@zutuanxue ~]# touch -a -t 202002010101.30 hello[root@zutuanxue ~]# stat hello  文件：hello  大小：0         块：0          IO 块：4096   普通空文件设备：fd00h/64768dInode：34502264    硬链接：1权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)最近访问：2020-02-01 01:01:30.000000000 -0500最近更改：2020-03-17 16:51:35.502961371 -0400最近改动：2020-03-17 16:51:53.143475189 -0400创建时间：-[root@zutuanxue ~]# touch -m -t 202002050101.30 hello[root@zutuanxue ~]# stat hello  文件：hello  大小：0         块：0          IO 块：4096   普通空文件设备：fd00h/64768dInode：34502264    硬链接：1权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)最近访问：2020-02-01 01:01:30.000000000 -0500最近更改：2020-02-05 01:01:30.000000000 -0500最近改动：2020-03-17 16:52:07.837453512 -0400创建时间：-#将hello-linux.txt的属性改成与anaconda-ks.cfg一样[root@zutuanxue ~]# stat hello-linux.txt   文件：hello-linux.txt  大小：12        块：8          IO 块：4096   普通文件设备：fd00h/64768dInode：34513350    硬链接：1权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)最近访问：2020-03-17 22:50:51.319377144 -0400最近更改：2020-03-17 22:50:45.909483733 -0400最近改动：2020-03-17 22:50:45.912483674 -0400创建时间：-[root@zutuanxue ~]# stat anaconda-ks.cfg   文件：anaconda-ks.cfg  大小：1378      块：8          IO 块：4096   普通文件设备：fd00h/64768dInode：34973658    硬链接：1权限：(0600/-rw-------)  Uid：(    0/    root)   Gid：(    0/    root)最近访问：2020-03-16 23:08:34.121427663 -0400最近更改：2020-02-04 15:01:33.273959663 -0500最近改动：2020-03-18 16:33:48.873881970 -0400创建时间：-[root@zutuanxue ~]# touch -r anaconda-ks.cfg hello-linux.txt [root@zutuanxue ~]# stat hello-linux.txt   文件：hello-linux.txt  大小：12        块：8          IO 块：4096   普通文件设备：fd00h/64768dInode：34513350    硬链接：1权限：(0644/-rw-r--r--)  Uid：(    0/    root)   Gid：(    0/    root)最近访问：2020-03-16 23:08:34.121427663 -0400最近更改：2020-02-04 15:01:33.273959663 -0500最近改动：2020-03-18 18:22:48.694597233 -0400创建时间：-</code></pre><ul><li>cat 查看文件内容</li></ul><pre><code>-A等价于-vET-b对非空输出行编号-e      等价于-vE-E在每行结束处显示$-n对输出的所有行编号-s不输出多行空行-t与-vT等价-T将跳格字符（tab）显示为 ^I-v使用^和M</code></pre><ul><li>rm 删除文件或目录</li></ul><pre><code>-f强制删除。忽略不存在的文件，不提示确认-i在删除前需要确认-I超过三个文件或者递归删除前要求确认。比-i提示内容更少-d删除空目录-r递归删除目录及其内容</code></pre><p>这些命令都是初学者可能会经常用到的，大家可以在自己的虚拟机上练习一下</p><ul><li>cp 拷贝</li></ul><pre><code>-i覆盖前询问(使前面的 -n 选项失效)-n不要覆盖已存在的文件(使前面的 -i 选项失效)-R, -r, --recursive递归复制目录及其子目录内的所有内容-s只创建符号链接而不复制文件-f强制，将目标文件无法打开则将其移除并重试</code></pre><ul><li>mv 移动&#x2F;改名</li></ul><pre><code>-f覆盖前不询问-i覆盖前询问-n不覆盖已存在文件#如果您指定了-i、-f、-n 中的多个，仅最后一个生效。</code></pre><h2 id="二、常用符号"><a href="#二、常用符号" class="headerlink" title="二、常用符号"></a>二、常用符号</h2><pre><code>*任意字符串?任意字符/路径间隔符~当前用户的家目录管理员家目录为/root，其它用户的家目录在/home/用户名</code></pre>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
